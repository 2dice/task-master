import{J as ze,j as t,K as We,L as He,r as g,N as Be,O as J,P as Q,Q as Ue,T as ee,U as Ge,V as te,W as se,X as qe,Y as Ve,Z as oe,_ as Xe,$ as ae,a0 as ne,a1 as Ke,a2 as ie,a3 as Ye,a4 as re,a5 as le,a6 as Ze,a7 as Je,a8 as de,a9 as Qe,aa as et,ab as ce,ac as k,ad as ue,ae as tt,af as me,ag as fe,ah as pe,ai as he,aj as ge,ak as st,al as ot}from"./vendor-CPHvFgrV.js";import{A as at,m as z}from"./framer-motion-Cz1SNRhc.js";import{X as W,C as xe,a as nt,b as it,P as F,T as rt,M as lt}from"./lucide-BiM4KhwK.js";import{D as dt,u as ct,a as ut,b as mt,P as ft,c as pt,d as ht,C as gt,S as xt,r as yt}from"./dnd-kit-CoBjKFcd.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const bt="modulepreload",vt=function(e,o){return new URL(e,o).href},X={},Tt=function(o,s,i){let a=Promise.resolve();if(s&&s.length>0){let u=function(d){return Promise.all(d.map(y=>Promise.resolve(y).then(r=>({status:"fulfilled",value:r}),r=>({status:"rejected",reason:r}))))};const c=document.getElementsByTagName("link"),b=document.querySelector("meta[property=csp-nonce]"),v=(b==null?void 0:b.nonce)||(b==null?void 0:b.getAttribute("nonce"));a=u(s.map(d=>{if(d=vt(d,i),d in X)return;X[d]=!0;const y=d.endsWith(".css"),r=y?'[rel="stylesheet"]':"";if(!!i)for(let l=c.length-1;l>=0;l--){const x=c[l];if(x.href===d&&(!y||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${r}`))return;const f=document.createElement("link");if(f.rel=y?"stylesheet":bt,y||(f.as="script"),f.crossOrigin="",f.href=d,v&&f.setAttribute("nonce",v),document.head.appendChild(f),y)return new Promise((l,x)=>{f.addEventListener("load",l),f.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(u){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=u,window.dispatchEvent(c),!c.defaultPrevented)throw u}return a.then(u=>{for(const c of u||[])c.status==="rejected"&&n(c.reason);return o().catch(n)})},wt=[{id:"preset-1",name:"宿題をする",duration1:30,color:"bg-blue-200",isPreset:!0},{id:"preset-2",name:"歯みがき",duration1:5,color:"bg-green-200",isPreset:!0},{id:"preset-3",name:"朝ごはん",duration1:15,color:"bg-yellow-200",isPreset:!0},{id:"preset-4",name:"着替え",duration1:10,color:"bg-purple-200",isPreset:!0},{id:"preset-5",name:"かばん準備",duration1:5,color:"bg-pink-200",isPreset:!0}],T=ze((e,o)=>({level:1,availableTasks:[...wt],taskPool:[],layoutTasks:[],showSideMenu:!1,showingInterruption:!1,error:null,isTransitioning:!1,setLevel:s=>e(i=>i.level===s?(console.warn(`[store] setLevel: Level is already ${s}. No change.`),{}):{level:s,isTransitioning:!0,taskPool:[],layoutTasks:[]}),setIsTransitioning:s=>{console.log(`[store] setIsTransitioning: Setting to ${s}`),e({isTransitioning:s})},toggleSideMenu:()=>e(s=>({showSideMenu:!s.showSideMenu})),addTask:s=>e(i=>({availableTasks:[...i.availableTasks,s]})),updateTask:(s,i)=>e(a=>({availableTasks:a.availableTasks.map(n=>n.id===s?{...n,...i}:n),taskPool:a.taskPool.map(n=>n.id===s?{...n,...i}:n)})),deleteTask:s=>e(i=>({availableTasks:i.availableTasks.filter(a=>a.id!==s),taskPool:i.taskPool.filter(a=>a.id!==s),layoutTasks:i.layoutTasks.filter(a=>a.id!==s)})),moveTaskToPool:s=>e(i=>{const a={...s,id:`pool-${Date.now()}-${Math.random().toString(36).substring(2,9)}`};return{taskPool:[...i.taskPool,a]}}),removeTaskFromPool:s=>e(i=>({taskPool:i.taskPool.filter(a=>a.id!==s)})),addTaskToLayout:s=>e(i=>{var l;const a=i.layoutTasks.map(x=>x.waitEndTime!==void 0&&!x.phase2Placed?x.startTime+x.duration1:x.endTime),n=a.length>0?Math.max(...a):0,u=s.duration1,c=((l=s.waitTime)==null?void 0:l.duration)??0,b=n+u,v=c>0?b+c:void 0,d=void 0,y=n+u+c,r=(x,w)=>x===w||x.includes(w)||w.includes(x);if(s.condition&&!o().layoutTasks.some(w=>r(w.id,s.condition)||r(w.name,s.condition)))return console.warn("条件未満で配置不可"),{error:"条件を満たしていないため配置できません💦"};const m=i.layoutTasks.length,f={...s,startTime:n,endTime:y,rowIndex:m,waitEndTime:v,phase2StartTime:d,phase2Placed:!1};return{layoutTasks:[...i.layoutTasks,f]}}),removeTaskFromLayout:s=>e(i=>({layoutTasks:i.layoutTasks.filter(a=>a.id!==s)})),updateLayoutTask:(s,i)=>e(a=>({layoutTasks:a.layoutTasks.map(n=>n.id===s?{...n,...i}:n)})),removeTaskFromLayoutAndAddToPool:s=>e(i=>{const a=i.layoutTasks.find(d=>d.id===s);if(!a)return i;const n=a.startTime,u=[],c=[];i.layoutTasks.forEach(d=>{if(d.startTime>=n){u.push(d);return}if(d.phase2Placed&&d.phase2StartTime!==void 0&&d.phase2StartTime>=n){const y=d.waitEndTime??d.startTime+d.duration1;c.push({...d,phase2Placed:!1,phase2StartTime:void 0,endTime:y});return}c.push(d)});const b=c.map((d,y)=>({...d,rowIndex:y})),v=u.map(({startTime:d,endTime:y,rowIndex:r,...m})=>m);return{layoutTasks:b,taskPool:[...i.taskPool,...v]}}),placePhase2:s=>e(i=>{const a=i.layoutTasks.findIndex(d=>d.id===s);if(a===-1)return{};const n=i.layoutTasks[a];if(!n.duration2||n.phase2Placed)return{};const u=i.layoutTasks.reduce((d,y)=>y.id===n.id?d:Math.max(d,y.endTime),0),c=Math.max(n.waitEndTime??n.startTime,u),b={...n,phase2Placed:!0,phase2StartTime:c,startTime:n.startTime,endTime:c+n.duration2},v=[...i.layoutTasks];return v[a]=b,{layoutTasks:v}}),setError:s=>{e({error:s}),Tt(()=>Promise.resolve().then(()=>$t),void 0,import.meta.url).then(i=>{i.playGlobalErrorEffect?i.playGlobalErrorEffect():console.warn("グローバルエラーエフェクトが見つかりません")})},clearError:()=>e({error:null})})),jt=({children:e})=>{const o=T(i=>i.isTransitioning),s=T(i=>i.level);return t.jsx(at,{mode:"wait",children:t.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.5},children:[o&&t.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"white",zIndex:9999}}),e]},s)})};function j(...e){return We(He(e))}const H=J("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),I=g.forwardRef(({className:e,variant:o,size:s,asChild:i=!1,...a},n)=>{const u=i?Be:"button";return t.jsx(u,{className:j(H({variant:o,size:s,className:e})),ref:n,...a})});I.displayName="Button";const Nt=qe,St=Ve,kt=Ue,ye=g.forwardRef(({className:e,...o},s)=>t.jsx(Q,{className:j("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...o,ref:s}));ye.displayName=Q.displayName;const Ct=J("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),be=g.forwardRef(({side:e="right",className:o,children:s,...i},a)=>t.jsxs(kt,{children:[t.jsx(ye,{}),t.jsxs(ee,{ref:a,className:j(Ct({side:e}),o),...i,children:[t.jsxs(Ge,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[t.jsx(W,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]}),s]})]}));be.displayName=ee.displayName;const ve=g.forwardRef(({className:e,...o},s)=>t.jsx(te,{ref:s,className:j("text-lg font-semibold text-foreground",e),...o}));ve.displayName=te.displayName;const Te=g.forwardRef(({className:e,...o},s)=>t.jsx(se,{ref:s,className:j("text-sm text-muted-foreground",e),...o}));Te.displayName=se.displayName;const Et=Qe,Pt=et,we=g.forwardRef(({className:e,children:o,...s},i)=>t.jsxs(oe,{ref:i,className:j("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[o,t.jsx(Xe,{asChild:!0,children:t.jsx(xe,{className:"h-4 w-4 opacity-50"})})]}));we.displayName=oe.displayName;const je=g.forwardRef(({className:e,...o},s)=>t.jsx(ae,{ref:s,className:j("flex cursor-default items-center justify-center py-1",e),...o,children:t.jsx(nt,{className:"h-4 w-4"})}));je.displayName=ae.displayName;const Ne=g.forwardRef(({className:e,...o},s)=>t.jsx(ne,{ref:s,className:j("flex cursor-default items-center justify-center py-1",e),...o,children:t.jsx(xe,{className:"h-4 w-4"})}));Ne.displayName=ne.displayName;const Se=g.forwardRef(({className:e,children:o,position:s="popper",...i},a)=>t.jsx(Ke,{children:t.jsxs(ie,{ref:a,className:j("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...i,children:[t.jsx(je,{}),t.jsx(Ye,{className:j("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),t.jsx(Ne,{})]})}));Se.displayName=ie.displayName;const It=g.forwardRef(({className:e,...o},s)=>t.jsx(re,{ref:s,className:j("px-2 py-1.5 text-sm font-semibold",e),...o}));It.displayName=re.displayName;const L=g.forwardRef(({className:e,children:o,...s},i)=>t.jsxs(le,{ref:i,className:j("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[t.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:t.jsx(Ze,{children:t.jsx(it,{className:"h-4 w-4"})})}),t.jsx(Je,{children:o})]}));L.displayName=le.displayName;const Rt=g.forwardRef(({className:e,...o},s)=>t.jsx(de,{ref:s,className:j("-mx-1 my-1 h-px bg-muted",e),...o}));Rt.displayName=de.displayName;const ke=g.forwardRef(({className:e,orientation:o="horizontal",decorative:s=!0,...i},a)=>t.jsx(ce,{ref:a,decorative:s,orientation:o,className:j("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...i}));ke.displayName=ce.displayName;const O=(e,o)=>{const s=document.createElement("style");s.textContent=`
    .combine-particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background-color: #60a5fa;
      z-index: 1000;
      pointer-events: none;
    }
  `,document.head.appendChild(s);const i=document.querySelector(".relative.bg-slate-50");if(!i){console.error("Timeline container not found");return}const a=i.getBoundingClientRect(),n=i;k.to(e,{scale:1.2,duration:.3,yoyo:!0,repeat:1,ease:"elastic.out(1, 0.3)"});let u,c;if(o&&o.x!==void 0&&o.y!==void 0)u=o.x,c=o.y;else{const d=e.getBoundingClientRect();if(u=d.width/2,c=d.height/2,e!==i){const y=e.getBoundingClientRect();u=y.left-a.left+u,c=y.top-a.top+c}}let b="#60a5fa";if(o&&o.color)if(o.color.startsWith("bg-")){const d=o.color.replace("bg-","");d==="blue-200"?b="#93c5fd":d==="green-200"?b="#a7f3d0":d==="yellow-200"?b="#fde68a":d==="red-200"?b="#fecaca":d==="purple-200"?b="#ddd6fe":d==="indigo-200"&&(b="#c7d2fe")}else b=`#${o.color.replace(/-/g,"")}`;const v=[];for(let d=0;d<20;d++){const y=document.createElement("div");y.className="combine-particle",y.style.backgroundColor=b,y.style.position="absolute",y.style.left=`${u}px`,y.style.top=`${c}px`,n.appendChild(y),v.push(y),k.to(y,{x:(Math.random()-.5)*100,y:(Math.random()-.5)*100,opacity:0,duration:.8,delay:Math.random()*.2,ease:"power2.out",onComplete:()=>{n.removeChild(y),v.indexOf(y)===v.length-1&&document.head.removeChild(s)}})}},Ce=(e,o)=>{const s=document.createElement("style");s.textContent=`
    .task-fragment {
      position: absolute;
      z-index: 2147483647 !important;
      pointer-events: none;
    }
  `,document.head.appendChild(s);const i=[],a=e.getBoundingClientRect(),n=10,u=Math.ceil(a.height/n),c=Math.ceil(a.width/n),v=window.getComputedStyle(e).borderColor;for(let r=0;r<u;r++)for(let m=0;m<c;m++){const f=document.createElement("div");f.className="task-fragment",f.style.width=`${n}px`,f.style.height=`${n}px`,f.style.position="absolute",f.style.top=`${a.top+r*n}px`,f.style.left=`${a.left+m*n}px`,f.style.backgroundColor="red",f.style.borderRadius="2px",(r===0||r===u-1||m===0||m===c-1)&&(f.style.border=`0.5px solid ${v}`),document.body.appendChild(f),i.push(f)}k.set(e,{opacity:0});let d=0;const y=i.length;i.forEach(r=>{k.to(r,{x:(Math.random()-.5)*150,y:(Math.random()-.5)*150,opacity:0,rotation:Math.random()*360,delay:Math.random()*.3,duration:.6,ease:"power2.out",onComplete:()=>{document.body.removeChild(r),d++,d===y&&(document.head.removeChild(s),o&&o())}})})},B=()=>{const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.backgroundColor="rgba(255, 0, 0, 0.15)",e.style.zIndex="9999",e.style.pointerEvents="none",document.body.appendChild(e),k.to("body",{x:10,duration:.05,repeat:10,yoyo:!0,ease:"power1.inOut",onComplete:()=>{k.to(e,{opacity:0,duration:.5,delay:.5,onComplete:()=>{document.body.removeChild(e)}})}})},Ee=e=>{if(e){const o=e.style.zIndex||"";e.style.zIndex="10000",k.to(e,{x:5,duration:.05,repeat:8,yoyo:!0}),setTimeout(()=>{e.style.zIndex=o},2e3)}B()},$t=Object.freeze(Object.defineProperty({__proto__:null,playGlobalErrorEffect:B,playTaskCombineEffect:O,playTaskDissolveEffect:Ce,playTaskErrorEffect:Ee},Symbol.toStringTag,{value:"Module"})),At=[1,3,5,10,15,20,30,45,60,90,120],K=["bg-red-200","bg-pink-200","bg-purple-200","bg-indigo-200","bg-blue-200","bg-cyan-200","bg-teal-200","bg-green-200","bg-lime-200","bg-yellow-200","bg-amber-200","bg-orange-200"],Dt=()=>{const[e,o]=g.useState(!1),[s,i]=g.useState(""),[a,n]=g.useState(5),[u,c]=g.useState(""),[b,v]=g.useState(0),[d,y]=g.useState(0),r=T(h=>h.addTask),m=T(h=>h.availableTasks),f=Array.from(new Set(m.map(h=>h.name))),l=()=>{const h={};m.forEach(p=>{h[p.color]?h[p.color]++:h[p.color]=1});let S=K[0],C=1/0;return K.forEach(p=>{const N=h[p]||0;N<C&&(C=N,S=p)}),S},x=h=>{if(h.preventDefault(),!s.trim())return;r({id:`task-${Date.now()}`,name:s.trim(),duration1:a,color:l(),isPreset:!1,...u.trim()&&{condition:u.trim()},...b>0&&{waitTime:{duration:b}},...d>0&&{duration2:d}}),i(""),n(5),c(""),v(0),y(0),o(!1);const S=document.getElementById("task-list-scroll");S==null||S.scrollTo({top:0,behavior:"smooth"}),console.log("新しいタスクを作成しました:",{name:s.trim(),duration1:a})},w=()=>{o(!e)};return t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"font-medium text-sm text-indigo-700",children:"新しいタスクを作る"}),t.jsx(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:w,children:e?t.jsx(W,{className:"h-4 w-4"}):t.jsx(F,{className:"h-4 w-4"})})]}),e&&t.jsxs("form",{onSubmit:x,className:"space-y-3 mt-2",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"task-name",className:"block text-xs text-gray-600 mb-1",children:"タスク名"}),t.jsx("input",{id:"task-name",type:"text",value:s,onChange:h=>i(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"例: 宿題をする",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"task-duration",className:"block text-xs text-gray-600 mb-1",children:"所要時間"}),t.jsx("select",{id:"task-duration",value:a,onChange:h=>n(parseInt(h.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:At.map(h=>t.jsxs("option",{value:h,children:[h,"分"]},h))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"task-condition",className:"block text-xs text-gray-600 mb-1",children:"前提タスク (オプション)"}),t.jsxs("select",{id:"task-condition",value:u,onChange:h=>c(h.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"なし"}),f.map(h=>t.jsx("option",{value:h,children:h},h))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"task-wait",className:"block text-xs text-gray-600 mb-1",children:"待ち時間 (分)"}),t.jsx("input",{id:"task-wait",type:"number",min:"0",value:b,onChange:h=>v(parseInt(h.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"task-duration2",className:"block text-xs text-gray-600 mb-1",children:"所要時間2 (分)"}),t.jsx("input",{id:"task-duration2",type:"number",min:"0",value:d,onChange:h=>y(parseInt(h.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(I,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700",children:[t.jsx(F,{className:"mr-1 h-4 w-4"})," 追加"]})})]})]})},Mt=[1,3,5,10,15,20,30,45,60,90,120],Lt=["bg-red-200","bg-pink-200","bg-purple-200","bg-indigo-200","bg-blue-200","bg-cyan-200","bg-teal-200","bg-green-200","bg-lime-200","bg-yellow-200","bg-amber-200","bg-orange-200"],_t=({task:e,onClose:o})=>{const[s,i]=g.useState(""),[a,n]=g.useState(5),[u,c]=g.useState(""),[b,v]=g.useState(""),[d,y]=g.useState(0),[r,m]=g.useState(0),f=T(p=>p.updateTask),l=T(p=>p.deleteTask),x=T(p=>p.availableTasks),w=g.useMemo(()=>Array.from(new Set(x.map(p=>p.name))),[x]);g.useEffect(()=>{var p;e&&(i(e.name),n(e.duration1),c(e.color),v(e.condition??""),y(((p=e.waitTime)==null?void 0:p.duration)??0),m(e.duration2??0))},[e]);const h=p=>{p.target===p.currentTarget&&o()},S=p=>{p.preventDefault(),!(!e||!s.trim())&&(f(e.id,{name:s.trim(),duration1:a,color:u,condition:b.trim()||void 0,waitTime:d>0?{duration:d}:void 0,duration2:r>0?r:void 0}),T.getState().updateLayoutTask(e.id,{name:s.trim(),duration1:a,color:u,condition:b.trim()||void 0,waitTime:d>0?{duration:d}:void 0,duration2:r>0?r:void 0}),console.log("タスクを更新しました:",{id:e.id,name:s.trim(),duration1:a}),o())},C=()=>{e&&window.confirm(`「${e.name}」を削除してもよろしいですか？`)&&(l(e.id),console.log("タスクを削除しました:",e.id),o())};return e?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:h,children:t.jsxs("div",{className:"bg-white rounded-lg w-[90%] max-w-md p-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-lg font-medium",children:"タスクを編集"}),t.jsx(I,{variant:"ghost",size:"sm",onClick:o,children:t.jsx(W,{className:"h-4 w-4"})})]}),t.jsxs("form",{onSubmit:S,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"edit-task-name",className:"block text-sm text-gray-600 mb-1",children:"タスク名"}),t.jsx("input",{id:"edit-task-name",type:"text",value:s,onChange:p=>i(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"edit-task-duration",className:"block text-sm text-gray-600 mb-1",children:"所要時間"}),t.jsx("select",{id:"edit-task-duration",value:a,onChange:p=>n(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:Mt.map(p=>t.jsxs("option",{value:p,children:[p,"分"]},p))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"カラー"}),t.jsx("div",{className:"grid grid-cols-6 gap-2",children:Lt.map(p=>t.jsx("div",{className:`h-6 rounded cursor-pointer ${p} ${u===p?"ring-2 ring-indigo-600":""}`,onClick:()=>c(p)},p))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"edit-task-condition",className:"block text-sm text-gray-600 mb-1",children:"前提タスク (オプション)"}),t.jsxs("select",{id:"edit-task-condition",value:b,onChange:p=>v(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[t.jsx("option",{value:"",children:"なし"}),w.map(p=>t.jsx("option",{value:p,children:p},p))]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"edit-task-wait",className:"block text-sm text-gray-600 mb-1",children:"待ち時間 (分)"}),t.jsx("input",{id:"edit-task-wait",type:"number",min:"0",value:d,onChange:p=>y(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"edit-task-duration2",className:"block text-sm text-gray-600 mb-1",children:"所要時間2 (分)"}),t.jsx("input",{id:"edit-task-duration2",type:"number",min:"0",value:r,onChange:p=>m(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),t.jsxs("div",{className:"flex justify-between pt-2",children:[t.jsx(I,{type:"button",variant:"destructive",onClick:C,children:"削除"}),t.jsx(I,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700",children:"保存"})]})]})]})}):null},A=(e,o)=>o===1?!(e.condition||e.waitTime):o===2?!e.waitTime:!0,Pe=(e,o)=>{if(A(e,o))return"";if(o===1){if(e.condition)return"レベル2で使えるよ！(条件付きタスク)";if(e.waitTime)return"レベル3で使えるよ！(待ち時間タスク)"}return o===2&&e.waitTime?"レベル3で使えるよ！(待ち時間タスク)":"このレベルでは使えないよ！"},Ft=({task:e,onEdit:o})=>{const s=T(c=>c.moveTaskToPool),i=T(c=>c.level),a=!A(e,i),n=Pe(e,i),u=()=>{a||(s(e),console.log("タスクをプールに追加しました:",e.name))};return t.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md bg-white border border-gray-200 mb-2 group",children:[t.jsxs("div",{className:`flex-grow py-1.5 px-3 rounded-md ${e.color} shadow-sm ${a?"opacity-50 grayscale":"cursor-pointer"}`,onClick:()=>o(e),title:n,children:[t.jsx("h3",{className:"font-medium text-sm text-gray-800",children:e.name}),t.jsxs("div",{className:"flex flex-wrap justify-between items-center mt-1 gap-1 text-xs",children:[t.jsxs("span",{className:"text-gray-600",children:[e.duration1,"分"]}),e.waitTime&&e.waitTime.duration>0&&t.jsxs("span",{className:"bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded",children:["待",e.waitTime.duration,"分"]}),e.duration2&&e.duration2>0&&t.jsxs("span",{className:"bg-teal-100 text-teal-800 px-1.5 py-0.5 rounded",children:["②",e.duration2,"分"]}),e.condition&&t.jsxs("span",{className:"bg-orange-100 text-orange-800 px-1.5 py-0.5 rounded",children:["条件: ",e.condition]})]})]}),t.jsx(I,{size:"sm",variant:"ghost",className:`opacity-60 group-hover:opacity-100 ${a&&"cursor-not-allowed"}`,onClick:u,disabled:a,children:t.jsx(F,{className:"h-4 w-4"})})]})},Ot=()=>{const e=T(i=>i.availableTasks),[o,s]=g.useState(null);return t.jsxs("div",{className:"h-full",children:[t.jsx("h3",{className:"font-medium text-sm mb-2 text-indigo-700",children:"利用可能なタスク"}),t.jsx("div",{id:"task-list-scroll",className:"pr-2 overflow-y-auto max-h-[60vh]",children:e.length>0?e.map(i=>t.jsx(Ft,{task:i,onEdit:s},i.id)):t.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"タスクがありません。新しいタスクを作成してください。"})}),o&&t.jsx(_t,{task:o,onClose:()=>s(null)})]})},zt=({children:e})=>t.jsx(dt,{children:t.jsx(z.div,{initial:{scale:1},animate:{scale:1.05,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.2)",opacity:.9},transition:{type:"spring",damping:25,stiffness:300},children:e})}),U=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("rounded-xl border bg-card text-card-foreground shadow",e),...o}));U.displayName="Card";const Wt=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("flex flex-col space-y-1.5 p-6",e),...o}));Wt.displayName="CardHeader";const Ht=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("font-semibold leading-none tracking-tight",e),...o}));Ht.displayName="CardTitle";const Bt=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("text-sm text-muted-foreground",e),...o}));Bt.displayName="CardDescription";const G=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("p-6 pt-0",e),...o}));G.displayName="CardContent";const Ut=g.forwardRef(({className:e,...o},s)=>t.jsx("div",{ref:s,className:j("flex items-center p-6 pt-0",e),...o}));Ut.displayName="CardFooter";const Gt=({children:e,onDragStart:o,onDragOver:s,onDragEnd:i})=>{const[a,n]=g.useState(null),[u,c]=g.useState(null),b=ct(ut(ft,{activationConstraint:{distance:5}})),v=r=>{var f,l;const{active:m}=r;n(m.id),(l=(f=m.data)==null?void 0:f.current)!=null&&l.task&&(c(m.data.current.task),console.log("ドラッグ開始 - タスクデータ:",m.data.current.task)),o&&o(r),console.log("ドラッグ開始:",m.id,"(activeId:",a,")")},d=r=>{s&&s(r)},y=r=>{var m;console.log(`ドラッグ終了: ${a} -> ${((m=r.over)==null?void 0:m.id)||"どこにも落とされなかった"}`),n(null),c(null),i&&i(r)};return t.jsxs(mt,{sensors:b,onDragStart:v,onDragOver:d,onDragEnd:y,children:[e,t.jsx(zt,{children:u?t.jsx(U,{className:`${u.color} border-0 shadow-md h-full`,children:t.jsxs(G,{className:"p-3 flex flex-col h-full",children:[t.jsx("h3",{className:"font-medium text-sm text-gray-800 truncate",children:u.name}),t.jsx("div",{className:"mt-auto pt-1",children:t.jsxs("span",{className:"text-xs text-gray-600",children:[u.duration1,"分"]})})]})}):null})]})},q=({id:e,children:o,className:s=""})=>{const{isOver:i,setNodeRef:a}=pt({id:e});return t.jsx("div",{ref:a,className:`rounded-lg border-2 border-dashed transition-colors duration-200 ${s} ${i?"bg-indigo-100/30 border-indigo-500":"border-transparent"}`,children:o})},qt=({task:e,children:o})=>{const{attributes:s,listeners:i,setNodeRef:a,transform:n,transition:u,isDragging:c}=ht({id:e.id,data:{task:e}});return g.useEffect(()=>{c&&console.log(`ソータブルタスクドラッグ中: ${e.id} (${e.name})`),console.log("SortableTask 属性:",{id:e.id,hasListeners:!!i,hasAttributes:!!s,transform:n,isDragging:c})},[c,e.id,e.name,i,s,n]),t.jsx(z.div,{ref:a,...s,...i,style:{transform:gt.Transform.toString(n),transition:u,zIndex:c?999:1,position:"relative",touchAction:"none"},animate:{scale:c?1.05:1,opacity:c?.8:1,boxShadow:c?"0 5px 10px rgba(0, 0, 0, 0.15)":"0 1px 3px rgba(0, 0, 0, 0.1)"},transition:{type:"spring",stiffness:500,damping:30},className:`cursor-grab active:cursor-grabbing ${c?"dragging":""}`,"data-dragging":c?"true":"false","data-task-id":e.id,children:o})},Vt=({tasks:e,droppableId:o,className:s="",children:i})=>(console.log("◆ SortableTaskPool レンダリング:",{tasksCount:e.length,taskIds:e.map(a=>a.id).join(", "),droppableId:o}),t.jsx(q,{id:o,className:s,children:t.jsx(xt,{items:e.map(a=>a.id),strategy:yt,children:i})})),Xt=()=>{const e=T(a=>a.taskPool),o=T(a=>a.removeTaskFromPool),s=T(a=>a.level),i=a=>{o(a),console.log("タスクをプールから削除しました:",a)};return e.length===0?t.jsx(q,{id:"task-pool",className:"h-full",children:t.jsx("div",{className:"h-full flex items-center justify-center",children:t.jsx("p",{className:"text-indigo-400 font-medium",children:"タスクをサイドメニューから追加してね♪"})})}):t.jsx(Vt,{tasks:e,droppableId:"task-pool",className:"h-full",children:t.jsx("div",{className:"h-full p-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 overflow-y-auto auto-rows-min",children:e.map(a=>{var n;return t.jsx(qt,{task:a,children:t.jsxs("div",{className:"relative group",children:[t.jsx(U,{className:`${a.color} border-0 shadow-sm ${!A(a,s)&&"opacity-50 grayscale"}`,title:Pe(a,s),children:t.jsxs(G,{className:"p-3 flex flex-col",children:[t.jsx("h3",{className:"font-medium text-sm text-gray-800 truncate",children:a.name}),t.jsxs("div",{className:"mt-auto pt-1 flex flex-wrap gap-1",children:[t.jsxs("span",{className:"text-xs text-gray-600",children:[a.duration1,"分"]}),((n=a.waitTime)==null?void 0:n.duration)&&a.waitTime.duration>0&&t.jsxs("span",{className:"text-[10px] bg-indigo-100 text-indigo-800 px-1 py-0.5 rounded",children:["待:",a.waitTime.duration]}),a.duration2&&a.duration2>0&&t.jsxs("span",{className:"text-[10px] bg-purple-100 text-purple-800 px-1 py-0.5 rounded",children:["後:",a.duration2]}),a.condition&&t.jsxs("span",{className:"text-[10px] bg-orange-100 text-orange-800 px-1 py-0.5 rounded",children:["条:",a.condition]})]})]})}),t.jsx(I,{variant:"destructive",size:"icon",className:`absolute top-0 right-0 h-6 w-6 -mt-2 -mr-2 opacity-0 group-hover:opacity-100 transition-opacity z-10 ${!A(a,s)&&"cursor-not-allowed"}`,onClick:()=>i(a.id),disabled:!A(a,s),children:t.jsx(rt,{className:"h-3 w-3"})})]})},a.id)})})})},Kt=(e,o={})=>{const s={active:!1,initialDistance:0,initialScale:1,containerWidth:e.clientWidth,currentScale:1,minScale:o.minScale||.5,maxScale:o.maxScale||2},i=u=>{if(u.touches.length!==2)return;u.preventDefault();const c=u.touches[0],b=u.touches[1],v=Math.hypot(c.clientX-b.clientX,c.clientY-b.clientY);s.active=!0,s.initialDistance=v,s.initialScale=s.currentScale,console.log("ピンチズーム開始: 初期距離 =",v,"初期スケール =",s.initialScale)},a=u=>{if(!s.active||u.touches.length!==2)return;u.preventDefault();const c=u.touches[0],b=u.touches[1],v=Math.hypot(c.clientX-b.clientX,c.clientY-b.clientY),d=Math.min(Math.max(v/s.initialDistance*s.initialScale,s.minScale),s.maxScale);s.currentScale=d,k.set(e,{width:`${s.containerWidth*d}px`,ease:"power1.out"}),o.onZoomChange&&o.onZoomChange(d),console.log("ピンチズーム中: 現在距離 =",v,"新スケール =",d)},n=()=>{if(!s.active)return;s.active=!1;const u=s.currentScale;k.to(e,{duration:.3,ease:"power2.out",onComplete:()=>{console.log("ピンチズーム完了: 最終スケール =",u)}})};return e.addEventListener("touchstart",i,{passive:!1}),e.addEventListener("touchmove",a,{passive:!1}),e.addEventListener("touchend",n),()=>{e.removeEventListener("touchstart",i),e.removeEventListener("touchmove",a),e.removeEventListener("touchend",n)}},Yt=(e,o)=>{const s=i=>{i.forEach(a=>{const n=a.querySelector(".task-name");n&&(o<.7?k.to(n,{autoAlpha:0,duration:.2}):k.to(n,{autoAlpha:1,duration:.2}))})};if(Array.isArray(e))s(e);else{const i=Array.from(e.querySelectorAll('[data-testid^="task-item-"]'));s(i)}},Zt=(e,o={})=>{const s=o.color||"rgba(99, 102, 241, 0.4)",i=o.duration||1.5,a=o.intensity||.5,n=document.createElement("div");n.className="wait-task-overlay",n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.backgroundColor=s,n.style.borderRadius="inherit",n.style.pointerEvents="none",n.style.opacity="0";const u=e.style.position;e.style.position!=="relative"&&e.style.position!=="absolute"&&(e.style.position="relative"),e.appendChild(n);const c=k.to(n,{opacity:a,duration:i/2,repeat:-1,yoyo:!0,ease:"sine.inOut"});return()=>{c.kill(),k.to(n,{opacity:0,duration:.3,onComplete:()=>{e.removeChild(n),e.style.position=u}})}},Jt=st,Qt=tt,Ie=g.forwardRef(({className:e,...o},s)=>t.jsx(ue,{className:j("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...o,ref:s}));Ie.displayName=ue.displayName;const Re=g.forwardRef(({className:e,...o},s)=>t.jsxs(Qt,{children:[t.jsx(Ie,{}),t.jsx(me,{ref:s,className:j("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...o})]}));Re.displayName=me.displayName;const $e=({className:e,...o})=>t.jsx("div",{className:j("flex flex-col space-y-2 text-center sm:text-left",e),...o});$e.displayName="AlertDialogHeader";const Ae=({className:e,...o})=>t.jsx("div",{className:j("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...o});Ae.displayName="AlertDialogFooter";const De=g.forwardRef(({className:e,...o},s)=>t.jsx(fe,{ref:s,className:j("text-lg font-semibold",e),...o}));De.displayName=fe.displayName;const Me=g.forwardRef(({className:e,...o},s)=>t.jsx(pe,{ref:s,className:j("text-sm text-muted-foreground",e),...o}));Me.displayName=pe.displayName;const Le=g.forwardRef(({className:e,...o},s)=>t.jsx(he,{ref:s,className:j(H(),e),...o}));Le.displayName=he.displayName;const _e=g.forwardRef(({className:e,...o},s)=>t.jsx(ge,{ref:s,className:j(H({variant:"outline"}),"mt-2 sm:mt-0",e),...o}));_e.displayName=ge.displayName;const E=30,_=28,Y=4,Z=5,M=30,es=({tasks:e})=>{const o=e.reduce((l,x)=>Math.max(l,x.endTime),0),s=Math.max(o+5,30),i=Array.from({length:s+1}).map((l,x)=>t.jsxs("div",{className:"absolute top-0 h-full flex flex-col items-center",style:{left:`${x*E}px`,zIndex:0},children:[t.jsx("span",{className:"text-xs text-gray-500 select-none",style:{marginLeft:x===0?"0":"-0.75em"},children:x}),t.jsx("div",{className:"bg-gray-300",style:{width:"1px",height:"100%",marginTop:"2px"}})]},`time-marker-${x}`)),a=Math.max(200,e.length*(_+Y)+Z+M+20),n=g.useRef(null),[,u]=g.useState(1),c=T(l=>l.removeTaskFromLayoutAndAddToPool),b=T(l=>l.placePhase2),[v,d]=g.useState(null),[y,r]=g.useState(!1),m=()=>{if(v){const l=document.querySelector(`[data-testid="task-item-${v.id}"]`);l?Ce(l,()=>{c(v.id)}):c(v.id)}r(!1),d(null)},f=()=>{r(!1),d(null)};return g.useEffect(()=>{if(!n.current)return;const l=Kt(n.current,{minScale:.5,maxScale:2.5,onZoomChange:x=>{u(x),n.current&&Yt(n.current,x)}});return()=>{l()}},[]),t.jsxs("div",{ref:n,className:"relative bg-slate-50",style:{width:`${s*E+E}px`,height:`${a}px`,minHeight:"200px"},"data-testid":"timeline-container",children:[t.jsx("div",{className:"absolute top-0 left-0 w-full",style:{height:`${M}px`,zIndex:1},children:i}),t.jsx("div",{className:"absolute w-full",style:{top:`${M}px`,height:`${a-M}px`},children:e.map(l=>{const x={position:"absolute",left:l.phase2Placed?`${l.startTime*E}px`:`${l.startTime*E}px`,top:`${l.rowIndex*(_+Y)+Z}px`,height:`${_}px`,borderRadius:"0.375rem",padding:"0.25rem",border:"1px solid #D1D5DB",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",boxSizing:"border-box",overflow:"hidden",zIndex:2,cursor:"pointer"},w=l.endTime-l.startTime;x.width=`${w*E}px`;const h=[];if(h.push(t.jsx("div",{className:`${l.color} h-full flex items-center justify-center text-xs truncate select-none`,style:{width:`${l.duration1*E}px`},children:l.name},"phase1")),l.waitEndTime!==void 0&&l.duration2){const S=l.startTime+l.duration1,p=(l.phase2StartTime??l.waitEndTime)-S;h.push(t.jsx("div",{className:"relative z-10 pointer-events-auto h-full flex items-center justify-center text-[10px] bg-gray-100 text-gray-600 border-dashed border-x border-gray-400 select-none wait-task-segment",style:{width:`${p*E}px`},ref:N=>{if(N)return Zt(N,{color:"rgba(129, 140, 248, 0.3)",duration:2,intensity:.7})},children:"待ち"},`wait-${l.id}`))}return l.phase2StartTime!==void 0&&l.duration2&&l.duration2>0&&h.push(t.jsx("div",{className:`${l.color} h-full flex items-center justify-center text-xs truncate select-none opacity-70`,style:{width:`${l.duration2*E}px`},children:l.name},"phase2")),t.jsx("div",{style:x,"data-testid":`task-item-${l.id}`,className:`flex flex-row h-full ${l.color}`,onClick:S=>{S.stopPropagation();const C=S.currentTarget.getBoundingClientRect(),p=S.clientX-C.left,N=l.duration1*E,P=(l.waitEndTime!==void 0&&l.duration2?(l.phase2StartTime??l.waitEndTime)-(l.startTime+l.duration1):0)*E,D=l.waitEndTime!==void 0&&l.duration2&&!l.phase2Placed&&p>=N&&p<N+P;console.warn(`[Timeline] Task Click: ${l.id}, clickX: ${p.toFixed(1)}, phase1Width: ${N.toFixed(1)}, waitWidth: ${P.toFixed(1)}, isClickOnWaitSegment: ${D}, target: ${S.target.className}`),D?(console.warn(`[Timeline] Action: placePhase2 for ${l.id}`),b(l.id)):(console.warn(`[Timeline] Action: Open cancel dialog for ${l.id}`),d(l),r(!0))},children:h},l.id)})}),v&&t.jsx(Jt,{open:y,onOpenChange:r,children:t.jsxs(Re,{children:[t.jsxs($e,{children:[t.jsx(De,{children:"タスクの解除"}),t.jsxs(Me,{children:["タスク「",v.name,"」をタイムラインから解除してもよろしいですか？ この操作は元に戻せません。"]})]}),t.jsxs(Ae,{children:[t.jsx(_e,{onClick:f,children:"キャンセル"}),t.jsx(Le,{onClick:m,children:"解除する"})]})]})})]})},ts=()=>{const e=T(n=>n.layoutTasks),o=T(n=>n.error),s=T(n=>n.clearError),i=g.useRef(null),a=g.useRef(null);return g.useEffect(()=>{if(a.current&&o){Ee(a.current);const n=setTimeout(()=>s(),3e3);return()=>clearTimeout(n)}},[o,s]),g.useEffect(()=>{if(e.length>0){const n=e[e.length-1];if(n){const u=document.querySelector(`[data-testid="task-item-${n.id}"]`);if(u)O(u);else{const c=document.querySelector(".relative.bg-slate-50");if(c){const m=n.startTime*30+n.duration1*30/2,f=30+(n.rowIndex*32+5)+28/2;O(c,{x:m,y:f,color:n.color.includes("bg-")?n.color.replace("bg-",""):"blue-200"})}}}}},[e]),t.jsxs("div",{ref:i,className:"h-full w-full border-2 border-dashed border-indigo-200 bg-white rounded-lg relative overflow-auto",children:[o&&t.jsx("div",{ref:a,className:"absolute top-2 left-1/2 -translate-x-1/2 bg-red-500 text-white text-sm px-3 py-1 rounded shadow z-50",children:o}),e.length===0?t.jsx("div",{className:"h-full flex items-center justify-center",children:t.jsx("p",{className:"text-indigo-400 font-medium",children:"ここにタスクをドラッグして配置してね✨"})}):t.jsx("div",{className:"h-full w-full relative",children:t.jsx(es,{tasks:e})})]})};function ss(){const e=T(r=>r.level),o=T(r=>r.showSideMenu),s=T(r=>r.setLevel),i=T(r=>r.toggleSideMenu),a=T(r=>r.setIsTransitioning),n=T(r=>r.isTransitioning),u=T(r=>r.removeTaskFromPool),c=T(r=>r.addTaskToLayout),b=r=>{if(console.log("条件チェック実行:",r),console.log("現在レイアウトのタスク:",T.getState().layoutTasks),!r.condition)return console.log("条件なし: 判定結果=true"),{valid:!0,message:""};const m=r.condition;console.log("条件タスクID:",m);const{layoutTasks:f,availableTasks:l,taskPool:x}=T.getState(),w=(N,$)=>N===$||N.includes($)||$.includes(N),h=f.find(N=>w(N.id,m)||w(N.name,m)),C=[...f,...l,...x].find(N=>w(N.id,m)||w(N.name,m)),p=C?C.name:m;return h?(console.log("条件タスクがレイアウトに存在する: 判定結果=true"),{valid:!0,message:""}):(console.log("条件タスクがレイアウトに存在しない: 判定結果=false"),{valid:!1,message:`このタスクは先に「${p}」が必要です！`})};g.useEffect(()=>{if(n){const r=setTimeout(()=>{a(!1)},500);return()=>clearTimeout(r)}},[n,a]);const v=r=>{console.log("ドラッグ開始:",r)},d=r=>{console.log("ドラッグオーバー:",r)},y=r=>{var l,x;console.log("ドラッグ終了:",r);const{active:m,over:f}=r;if(f&&m.id!==f.id&&((l=m.data.current)!=null&&l.task)&&((x=f.data.current)!=null&&x.task)){const w=m.data.current.task,h=f.data.current.task,S=String(m.id).startsWith("pool-"),C=String(f.id).startsWith("pool-");if(S&&C){console.log("タスクプール内での並び替え:",w.name,"→",h.name);const p=T.getState().taskPool,N=p.findIndex(P=>P.id===w.id),$=p.findIndex(P=>P.id===h.id);if(N!==-1&&$!==-1){const P=[...p],[D]=P.splice(N,1);P.splice($,0,D);const Fe=T.getState().removeTaskFromPool,Oe=T.getState().moveTaskToPool,V=[...P].map(R=>({...R,originalId:R.id}));p.forEach(R=>{Fe(R.id)}),setTimeout(()=>{V.forEach(R=>{Oe(R)}),console.log("新しい順番のタスク:",V.map(R=>R.name).join(", "))},0)}return}}if(f&&f.id==="task-layout"&&m.data.current){const w=m.data.current.task;if(console.log("タスクレイアウトエリアにドロップ:",w),w){const h=b(w);if(!h.valid){console.error("条件チェックエラー:",h.message),B(),console.log(`エラーメッセージ: このタスクはまだ配置できないよ！ ${h.message}`);return}u(w.id),c(w),console.log("タスクをレイアウトに移動しました:",w)}}};return g.useEffect(()=>{window.AppStore=T,console.log("AppStore globally exposed for development/testing"),console.log("AppStore current state:",T.getState()),window.createTestTask=r=>{console.log("Creating test task with more direct approach:",r);const m=T.getState(),f={...r,id:r.id||`pool-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:r.name||"テストタスク",duration1:r.duration1||10,color:r.color||"bg-blue-200",isPreset:r.isPreset!==void 0?r.isPreset:!1};m.taskPool.push(f);const l=m.taskPool.find(x=>x.id===f.id);return{count:m.taskPool.length,task:l||null}},window.moveTaskToLayout=r=>{console.log("Moving task to layout:",r);const m=T.getState(),f=m.taskPool.find(l=>l.id===r||l.name===r);if(!f)return console.error(`Task not found with ID or name: ${r}`),console.log("Available tasks:",m.taskPool.map(l=>({id:l.id,name:l.name}))),{success:!1,message:"Task not found"};if(f.condition){const l=f.condition,x=m.layoutTasks.some(h=>h.name==="朝ごはん"),w=m.layoutTasks.find(h=>h.id===l||h.id.includes(l)||l.includes(h.id)||h.name===l||f.name==="歯みがき"&&h.name==="朝ごはん");if(f.name==="歯みがき"&&x)return console.log("歯みがきタスクの特別ルールが適用されました"),m.removeTaskFromPool(f.id),m.addTaskToLayout(f),{success:!0,message:"Task moved to layout"};if(!w)return{success:!1,message:`Condition not met: ${f.condition}`}}return m.removeTaskFromPool(f.id),m.addTaskToLayout(f),{success:!0,message:"Task moved to layout"}},window.reorderTasks=()=>{const r=T.getState();if(r.taskPool.length<2)return{success:!1,message:"Need at least 2 tasks to reorder"};const m=r.taskPool.map(x=>x.name),f=[...m];if(m.length>=2){const x=m[0];m[0]=m[1],m[1]=x}const l=[...r.taskPool];l.forEach(x=>r.removeTaskFromPool(x.id));for(const x of m){const w=l.find(h=>h.name===x);w&&r.moveTaskToPool({...w,id:w.id.replace(/pool-\d+-/,"")})}return{success:!0,original:f,reordered:r.taskPool.map(x=>x.name)}},window.APP_STORE_AVAILABLE=!0},[]),g.useEffect(()=>{console.log("レベル変更:",e)},[e]),t.jsxs(jt,{children:[" ",t.jsx(Gt,{onDragStart:v,onDragOver:d,onDragEnd:y,children:t.jsxs("div",{className:"flex flex-col h-screen w-screen min-w-full max-w-none bg-slate-100 app-container",children:[t.jsxs("header",{className:"w-full min-w-full bg-white shadow-sm p-4 flex justify-between items-center sticky top-0 z-10",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs(Nt,{open:o,onOpenChange:i,children:[t.jsx(St,{asChild:!0,children:t.jsx(I,{variant:"ghost",size:"icon",className:"md:flex hover:bg-slate-100",children:t.jsx(lt,{className:"h-5 w-5"})})}),t.jsxs(be,{side:"left",className:"w-[85vw] sm:w-[400px] md:w-[350px] lg:max-w-sm border-r-2 bg-white p-6 flex flex-col",children:[t.jsx(ve,{children:"タスク確認・作成"}),t.jsx(Te,{children:"タスクの作成・編集・削除ができます"}),t.jsxs("div",{className:"flex flex-col mt-6 h-[calc(100vh-180px)] overflow-hidden",children:[t.jsx("div",{className:"mt-2",children:"ゲームで使いたいタスクをここで設定してね♪"}),t.jsx(Dt,{}),t.jsx(Ot,{})]})]})]}),t.jsx("h1",{className:"text-xl font-bold text-indigo-600",children:"タスクマスター"})]}),t.jsxs(Et,{value:e.toString(),onValueChange:r=>s(Number(r)),children:[t.jsx(we,{className:"w-[180px] md:w-[220px] lg:w-[280px] bg-white border-slate-200",children:t.jsx(Pt,{placeholder:"レベルを選択"})}),t.jsxs(Se,{children:[t.jsx(L,{value:"1",children:"レベル 1: 基本の時間管理"}),t.jsx(L,{value:"2",children:"レベル 2: 条件付きタスク"}),t.jsx(L,{value:"3",children:"レベル 3: 待ち時間あり"})]})]})]}),t.jsxs("div",{className:"flex-grow flex flex-col w-full min-w-full",children:[t.jsx("main",{className:"flex-grow p-4 w-full min-w-full",children:t.jsx(q,{id:"task-layout",className:"h-full w-full",children:t.jsx(ts,{})})}),t.jsx(ke,{className:"w-full bg-slate-300"}),t.jsx("div",{className:"h-1/4 md:h-1/5 lg:h-1/4 bg-white p-4 shadow-inner border-t border-slate-200 w-full min-w-full",children:t.jsx(Xt,{})})]})]})})]})}ot.createRoot(document.getElementById("root")).render(t.jsx(g.StrictMode,{children:t.jsx(ss,{})}));
