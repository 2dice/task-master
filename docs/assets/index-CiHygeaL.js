import{J as Ee,K as Re,r as m,j as e,L as Ae,N as V,O as W,P as Me,Q as K,T as Le,U as q,V as G,W as Fe,X as Oe,Y as J,Z as ze,_ as X,$ as Q,a0 as _e,a1 as Y,a2 as Be,a3 as Z,a4 as ee,a5 as He,a6 as Ue,a7 as te,a8 as Ve,a9 as We,aa as se,ab as Ke,ac as ae,ad as qe,ae as oe,af as ne,ag as re,ah as ie,ai as le,aj as Ge,ak as Je}from"./vendor-HCosByvC.js";import{X as M,C as de,a as Xe,b as Qe,P as A,T as Ye,M as Ze}from"./lucide-DFTFaQve.js";import{D as et,u as tt,a as st,b as at,P as ot,c as nt,d as rt,C as it,S as lt,r as dt}from"./dnd-kit-BYhS-_cm.js";import{m as ce}from"./framer-motion-BqqH-E-_.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const h of i.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();function v(...t){return Ee(Re(t))}const L=V("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),C=m.forwardRef(({className:t,variant:o,size:s,asChild:n=!1,...a},i)=>{const h=n?Ae:"button";return e.jsx(h,{className:v(L({variant:o,size:s,className:t})),ref:i,...a})});C.displayName="Button";const ct=Fe,mt=Oe,ut=Me,me=m.forwardRef(({className:t,...o},s)=>e.jsx(W,{className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o,ref:s}));me.displayName=W.displayName;const xt=V("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),ue=m.forwardRef(({side:t="right",className:o,children:s,...n},a)=>e.jsxs(ut,{children:[e.jsx(me,{}),e.jsxs(K,{ref:a,className:v(xt({side:t}),o),...n,children:[e.jsxs(Le,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),s]})]}));ue.displayName=K.displayName;const xe=m.forwardRef(({className:t,...o},s)=>e.jsx(q,{ref:s,className:v("text-lg font-semibold text-foreground",t),...o}));xe.displayName=q.displayName;const ge=m.forwardRef(({className:t,...o},s)=>e.jsx(G,{ref:s,className:v("text-sm text-muted-foreground",t),...o}));ge.displayName=G.displayName;const gt=Ve,pt=We,pe=m.forwardRef(({className:t,children:o,...s},n)=>e.jsxs(J,{ref:n,className:v("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[o,e.jsx(ze,{asChild:!0,children:e.jsx(de,{className:"h-4 w-4 opacity-50"})})]}));pe.displayName=J.displayName;const fe=m.forwardRef(({className:t,...o},s)=>e.jsx(X,{ref:s,className:v("flex cursor-default items-center justify-center py-1",t),...o,children:e.jsx(Xe,{className:"h-4 w-4"})}));fe.displayName=X.displayName;const he=m.forwardRef(({className:t,...o},s)=>e.jsx(Q,{ref:s,className:v("flex cursor-default items-center justify-center py-1",t),...o,children:e.jsx(de,{className:"h-4 w-4"})}));he.displayName=Q.displayName;const be=m.forwardRef(({className:t,children:o,position:s="popper",...n},a)=>e.jsx(_e,{children:e.jsxs(Y,{ref:a,className:v("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[e.jsx(fe,{}),e.jsx(Be,{className:v("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:o}),e.jsx(he,{})]})}));be.displayName=Y.displayName;const ft=m.forwardRef(({className:t,...o},s)=>e.jsx(Z,{ref:s,className:v("px-2 py-1.5 text-sm font-semibold",t),...o}));ft.displayName=Z.displayName;const E=m.forwardRef(({className:t,children:o,...s},n)=>e.jsxs(ee,{ref:n,className:v("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(He,{children:e.jsx(Qe,{className:"h-4 w-4"})})}),e.jsx(Ue,{children:o})]}));E.displayName=ee.displayName;const ht=m.forwardRef(({className:t,...o},s)=>e.jsx(te,{ref:s,className:v("-mx-1 my-1 h-px bg-muted",t),...o}));ht.displayName=te.displayName;const ye=m.forwardRef(({className:t,orientation:o="horizontal",decorative:s=!0,...n},a)=>e.jsx(se,{ref:a,decorative:s,orientation:o,className:v("shrink-0 bg-border",o==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...n}));ye.displayName=se.displayName;const bt=[{id:"preset-1",name:"宿題をする",duration1:30,color:"bg-blue-200",isPreset:!0},{id:"preset-2",name:"歯みがき",duration1:5,color:"bg-green-200",isPreset:!0},{id:"preset-3",name:"朝ごはん",duration1:15,color:"bg-yellow-200",isPreset:!0},{id:"preset-4",name:"着替え",duration1:10,color:"bg-purple-200",isPreset:!0},{id:"preset-5",name:"かばん準備",duration1:5,color:"bg-pink-200",isPreset:!0}],y=Ke((t,o)=>({level:1,availableTasks:[...bt],taskPool:[],layoutTasks:[],showSideMenu:!1,showingInterruption:!1,error:null,setLevel:s=>t({level:s}),toggleSideMenu:()=>t(s=>({showSideMenu:!s.showSideMenu})),addTask:s=>t(n=>({availableTasks:[...n.availableTasks,s]})),updateTask:(s,n)=>t(a=>({availableTasks:a.availableTasks.map(i=>i.id===s?{...i,...n}:i),taskPool:a.taskPool.map(i=>i.id===s?{...i,...n}:i)})),deleteTask:s=>t(n=>({availableTasks:n.availableTasks.filter(a=>a.id!==s),taskPool:n.taskPool.filter(a=>a.id!==s),layoutTasks:n.layoutTasks.filter(a=>a.id!==s)})),moveTaskToPool:s=>t(n=>{const a={...s,id:`pool-${Date.now()}-${Math.random().toString(36).substring(2,9)}`};return{taskPool:[...n.taskPool,a]}}),removeTaskFromPool:s=>t(n=>({taskPool:n.taskPool.filter(a=>a.id!==s)})),addTaskToLayout:s=>t(n=>{var g;const a=n.layoutTasks.map(b=>b.waitEndTime!==void 0&&!b.phase2Placed?b.startTime+b.duration1:b.endTime),i=a.length>0?Math.max(...a):0,h=s.duration1,f=((g=s.waitTime)==null?void 0:g.duration)??0,T=i+h,w=f>0?T+f:void 0,r=void 0,d=i+h+f,u=(b,N)=>b===N||b.includes(N)||N.includes(b);if(s.condition&&!o().layoutTasks.some(N=>u(N.id,s.condition)||u(N.name,s.condition)))return console.warn("条件未満で配置不可"),{error:"条件を満たしていないため配置できません💦"};const x=n.layoutTasks.length,l={...s,startTime:i,endTime:d,rowIndex:x,waitEndTime:w,phase2StartTime:r,phase2Placed:!1};return{layoutTasks:[...n.layoutTasks,l]}}),removeTaskFromLayout:s=>t(n=>({layoutTasks:n.layoutTasks.filter(a=>a.id!==s)})),updateLayoutTask:(s,n)=>t(a=>({layoutTasks:a.layoutTasks.map(i=>i.id===s?{...i,...n}:i)})),removeTaskFromLayoutAndAddToPool:s=>t(n=>{const a=n.layoutTasks.find(r=>r.id===s);if(!a)return n;const i=a.startTime,h=[],f=[];n.layoutTasks.forEach(r=>{if(r.startTime>=i){h.push(r);return}if(r.phase2Placed&&r.phase2StartTime!==void 0&&r.phase2StartTime>=i){const d=r.waitEndTime??r.startTime+r.duration1;f.push({...r,phase2Placed:!1,phase2StartTime:void 0,endTime:d});return}f.push(r)});const T=f.map((r,d)=>({...r,rowIndex:d})),w=h.map(({startTime:r,endTime:d,rowIndex:u,...x})=>x);return{layoutTasks:T,taskPool:[...n.taskPool,...w]}}),placePhase2:s=>t(n=>{const a=n.layoutTasks.findIndex(r=>r.id===s);if(a===-1)return{};const i=n.layoutTasks[a];if(!i.duration2||i.phase2Placed)return{};const h=n.layoutTasks.reduce((r,d)=>d.id===i.id?r:Math.max(r,d.endTime),0),f=Math.max(i.waitEndTime??i.startTime,h),T={...i,phase2Placed:!0,phase2StartTime:f,startTime:i.startTime,endTime:f+i.duration2},w=[...n.layoutTasks];return w[a]=T,{layoutTasks:w}}),setError:s=>t({error:s}),clearError:()=>t({error:null})})),yt=[1,3,5,10,15,20,30,45,60,90,120],B=["bg-red-200","bg-pink-200","bg-purple-200","bg-indigo-200","bg-blue-200","bg-cyan-200","bg-teal-200","bg-green-200","bg-lime-200","bg-yellow-200","bg-amber-200","bg-orange-200"],vt=()=>{const[t,o]=m.useState(!1),[s,n]=m.useState(""),[a,i]=m.useState(5),[h,f]=m.useState(""),[T,w]=m.useState(0),[r,d]=m.useState(0),u=y(p=>p.addTask),x=y(p=>p.availableTasks),l=Array.from(new Set(x.map(p=>p.name))),g=()=>{const p={};x.forEach(c=>{p[c.color]?p[c.color]++:p[c.color]=1});let k=B[0],j=1/0;return B.forEach(c=>{const S=p[c]||0;S<j&&(j=S,k=c)}),k},b=p=>{if(p.preventDefault(),!s.trim())return;u({id:`task-${Date.now()}`,name:s.trim(),duration1:a,color:g(),isPreset:!1,...h.trim()&&{condition:h.trim()},...T>0&&{waitTime:{duration:T}},...r>0&&{duration2:r}}),n(""),i(5),f(""),w(0),d(0),o(!1);const k=document.getElementById("task-list-scroll");k==null||k.scrollTo({top:0,behavior:"smooth"}),console.log("新しいタスクを作成しました:",{name:s.trim(),duration1:a})},N=()=>{o(!t)};return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-sm text-indigo-700",children:"新しいタスクを作る"}),e.jsx(C,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:N,children:t?e.jsx(M,{className:"h-4 w-4"}):e.jsx(A,{className:"h-4 w-4"})})]}),t&&e.jsxs("form",{onSubmit:b,className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task-name",className:"block text-xs text-gray-600 mb-1",children:"タスク名"}),e.jsx("input",{id:"task-name",type:"text",value:s,onChange:p=>n(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"例: 宿題をする",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task-duration",className:"block text-xs text-gray-600 mb-1",children:"所要時間"}),e.jsx("select",{id:"task-duration",value:a,onChange:p=>i(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:yt.map(p=>e.jsxs("option",{value:p,children:[p,"分"]},p))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task-condition",className:"block text-xs text-gray-600 mb-1",children:"前提タスク (オプション)"}),e.jsxs("select",{id:"task-condition",value:h,onChange:p=>f(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"なし"}),l.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task-wait",className:"block text-xs text-gray-600 mb-1",children:"待ち時間 (分)"}),e.jsx("input",{id:"task-wait",type:"number",min:"0",value:T,onChange:p=>w(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"task-duration2",className:"block text-xs text-gray-600 mb-1",children:"所要時間2 (分)"}),e.jsx("input",{id:"task-duration2",type:"number",min:"0",value:r,onChange:p=>d(parseInt(p.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(C,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700",children:[e.jsx(A,{className:"mr-1 h-4 w-4"})," 追加"]})})]})]})},Tt=[1,3,5,10,15,20,30,45,60,90,120],jt=["bg-red-200","bg-pink-200","bg-purple-200","bg-indigo-200","bg-blue-200","bg-cyan-200","bg-teal-200","bg-green-200","bg-lime-200","bg-yellow-200","bg-amber-200","bg-orange-200"],wt=({task:t,onClose:o})=>{const[s,n]=m.useState(""),[a,i]=m.useState(5),[h,f]=m.useState(""),[T,w]=m.useState(""),[r,d]=m.useState(0),[u,x]=m.useState(0),l=y(c=>c.updateTask),g=y(c=>c.deleteTask),b=y(c=>c.availableTasks),N=m.useMemo(()=>Array.from(new Set(b.map(c=>c.name))),[b]);m.useEffect(()=>{var c;t&&(n(t.name),i(t.duration1),f(t.color),w(t.condition??""),d(((c=t.waitTime)==null?void 0:c.duration)??0),x(t.duration2??0))},[t]);const p=c=>{c.target===c.currentTarget&&o()},k=c=>{c.preventDefault(),!(!t||!s.trim())&&(l(t.id,{name:s.trim(),duration1:a,color:h,condition:T.trim()||void 0,waitTime:r>0?{duration:r}:void 0,duration2:u>0?u:void 0}),y.getState().updateLayoutTask(t.id,{name:s.trim(),duration1:a,color:h,condition:T.trim()||void 0,waitTime:r>0?{duration:r}:void 0,duration2:u>0?u:void 0}),console.log("タスクを更新しました:",{id:t.id,name:s.trim(),duration1:a}),o())},j=()=>{t&&window.confirm(`「${t.name}」を削除してもよろしいですか？`)&&(g(t.id),console.log("タスクを削除しました:",t.id),o())};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:p,children:e.jsxs("div",{className:"bg-white rounded-lg w-[90%] max-w-md p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",children:"タスクを編集"}),e.jsx(C,{variant:"ghost",size:"sm",onClick:o,children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-task-name",className:"block text-sm text-gray-600 mb-1",children:"タスク名"}),e.jsx("input",{id:"edit-task-name",type:"text",value:s,onChange:c=>n(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-task-duration",className:"block text-sm text-gray-600 mb-1",children:"所要時間"}),e.jsx("select",{id:"edit-task-duration",value:a,onChange:c=>i(parseInt(c.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:Tt.map(c=>e.jsxs("option",{value:c,children:[c,"分"]},c))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"カラー"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:jt.map(c=>e.jsx("div",{className:`h-6 rounded cursor-pointer ${c} ${h===c?"ring-2 ring-indigo-600":""}`,onClick:()=>f(c)},c))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-task-condition",className:"block text-sm text-gray-600 mb-1",children:"前提タスク (オプション)"}),e.jsxs("select",{id:"edit-task-condition",value:T,onChange:c=>w(c.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"なし"}),N.map(c=>e.jsx("option",{value:c,children:c},c))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-task-wait",className:"block text-sm text-gray-600 mb-1",children:"待ち時間 (分)"}),e.jsx("input",{id:"edit-task-wait",type:"number",min:"0",value:r,onChange:c=>d(parseInt(c.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-task-duration2",className:"block text-sm text-gray-600 mb-1",children:"所要時間2 (分)"}),e.jsx("input",{id:"edit-task-duration2",type:"number",min:"0",value:u,onChange:c=>x(parseInt(c.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-between pt-2",children:[e.jsx(C,{type:"button",variant:"destructive",onClick:j,children:"削除"}),e.jsx(C,{type:"submit",className:"bg-indigo-600 hover:bg-indigo-700",children:"保存"})]})]})]})}):null},I=(t,o)=>o===1?!(t.condition||t.waitTime):o===2?!t.waitTime:!0,ve=(t,o)=>{if(I(t,o))return"";if(o===1){if(t.condition)return"レベル2で使えるよ！(条件付きタスク)";if(t.waitTime)return"レベル3で使えるよ！(待ち時間タスク)"}return o===2&&t.waitTime?"レベル3で使えるよ！(待ち時間タスク)":"このレベルでは使えないよ！"},Nt=({task:t,onEdit:o})=>{const s=y(f=>f.moveTaskToPool),n=y(f=>f.level),a=!I(t,n),i=ve(t,n),h=()=>{a||(s(t),console.log("タスクをプールに追加しました:",t.name))};return e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md bg-white border border-gray-200 mb-2 group",children:[e.jsxs("div",{className:`flex-grow py-1.5 px-3 rounded-md ${t.color} shadow-sm ${a?"opacity-50 grayscale":"cursor-pointer"}`,onClick:()=>o(t),title:i,children:[e.jsx("h3",{className:"font-medium text-sm text-gray-800",children:t.name}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center mt-1 gap-1 text-xs",children:[e.jsxs("span",{className:"text-gray-600",children:[t.duration1,"分"]}),t.waitTime&&t.waitTime.duration>0&&e.jsxs("span",{className:"bg-blue-100 text-blue-800 px-1.5 py-0.5 rounded",children:["待",t.waitTime.duration,"分"]}),t.duration2&&t.duration2>0&&e.jsxs("span",{className:"bg-teal-100 text-teal-800 px-1.5 py-0.5 rounded",children:["②",t.duration2,"分"]}),t.condition&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 px-1.5 py-0.5 rounded",children:["条件: ",t.condition]})]})]}),e.jsx(C,{size:"sm",variant:"ghost",className:`opacity-60 group-hover:opacity-100 ${a&&"cursor-not-allowed"}`,onClick:h,disabled:a,children:e.jsx(A,{className:"h-4 w-4"})})]})},kt=()=>{const t=y(n=>n.availableTasks),[o,s]=m.useState(null);return e.jsxs("div",{className:"h-full",children:[e.jsx("h3",{className:"font-medium text-sm mb-2 text-indigo-700",children:"利用可能なタスク"}),e.jsx("div",{id:"task-list-scroll",className:"pr-2 overflow-y-auto max-h-[60vh]",children:t.length>0?t.map(n=>e.jsx(Nt,{task:n,onEdit:s},n.id)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"タスクがありません。新しいタスクを作成してください。"})}),o&&e.jsx(wt,{task:o,onClose:()=>s(null)})]})},St=({children:t})=>e.jsx(et,{children:e.jsx(ce.div,{initial:{scale:1},animate:{scale:1.05,boxShadow:"0 5px 15px rgba(0, 0, 0, 0.2)",opacity:.9},transition:{type:"spring",damping:25,stiffness:300},children:t})}),F=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("rounded-xl border bg-card text-card-foreground shadow",t),...o}));F.displayName="Card";const Pt=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("flex flex-col space-y-1.5 p-6",t),...o}));Pt.displayName="CardHeader";const Ct=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("font-semibold leading-none tracking-tight",t),...o}));Ct.displayName="CardTitle";const Dt=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("text-sm text-muted-foreground",t),...o}));Dt.displayName="CardDescription";const O=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("p-6 pt-0",t),...o}));O.displayName="CardContent";const It=m.forwardRef(({className:t,...o},s)=>e.jsx("div",{ref:s,className:v("flex items-center p-6 pt-0",t),...o}));It.displayName="CardFooter";const $t=({children:t,onDragStart:o,onDragOver:s,onDragEnd:n})=>{const[a,i]=m.useState(null),[h,f]=m.useState(null),T=tt(st(ot,{activationConstraint:{distance:5}})),w=u=>{var l,g;const{active:x}=u;i(x.id),(g=(l=x.data)==null?void 0:l.current)!=null&&g.task&&(f(x.data.current.task),console.log("ドラッグ開始 - タスクデータ:",x.data.current.task)),o&&o(u),console.log("ドラッグ開始:",x.id,"(activeId:",a,")")},r=u=>{s&&s(u)},d=u=>{var x;console.log(`ドラッグ終了: ${a} -> ${((x=u.over)==null?void 0:x.id)||"どこにも落とされなかった"}`),i(null),f(null),n&&n(u)};return e.jsxs(at,{sensors:T,onDragStart:w,onDragOver:r,onDragEnd:d,children:[t,e.jsx(St,{children:h?e.jsx(F,{className:`${h.color} border-0 shadow-md h-full`,children:e.jsxs(O,{className:"p-3 flex flex-col h-full",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-800 truncate",children:h.name}),e.jsx("div",{className:"mt-auto pt-1",children:e.jsxs("span",{className:"text-xs text-gray-600",children:[h.duration1,"分"]})})]})}):null})]})},z=({id:t,children:o,className:s=""})=>{const{isOver:n,setNodeRef:a}=nt({id:t});return e.jsx("div",{ref:a,className:`rounded-lg border-2 border-dashed transition-colors duration-200 ${s} ${n?"bg-indigo-100/30 border-indigo-500":"border-transparent"}`,children:o})},Et=({task:t,children:o})=>{const{attributes:s,listeners:n,setNodeRef:a,transform:i,transition:h,isDragging:f}=rt({id:t.id,data:{task:t}});return m.useEffect(()=>{f&&console.log(`ソータブルタスクドラッグ中: ${t.id} (${t.name})`),console.log("SortableTask 属性:",{id:t.id,hasListeners:!!n,hasAttributes:!!s,transform:i,isDragging:f})},[f,t.id,t.name,n,s,i]),e.jsx(ce.div,{ref:a,...s,...n,style:{transform:it.Transform.toString(i),transition:h,zIndex:f?999:1,position:"relative",touchAction:"none"},animate:{scale:f?1.05:1,opacity:f?.8:1,boxShadow:f?"0 5px 10px rgba(0, 0, 0, 0.15)":"0 1px 3px rgba(0, 0, 0, 0.1)"},transition:{type:"spring",stiffness:500,damping:30},className:`cursor-grab active:cursor-grabbing ${f?"dragging":""}`,"data-dragging":f?"true":"false","data-task-id":t.id,children:o})},Rt=({tasks:t,droppableId:o,className:s="",children:n})=>(console.log("◆ SortableTaskPool レンダリング:",{tasksCount:t.length,taskIds:t.map(a=>a.id).join(", "),droppableId:o}),e.jsx(z,{id:o,className:s,children:e.jsx(lt,{items:t.map(a=>a.id),strategy:dt,children:n})})),At=()=>{const t=y(a=>a.taskPool),o=y(a=>a.removeTaskFromPool),s=y(a=>a.level),n=a=>{o(a),console.log("タスクをプールから削除しました:",a)};return t.length===0?e.jsx(z,{id:"task-pool",className:"h-full",children:e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-indigo-400 font-medium",children:"タスクをサイドメニューから追加してね♪"})})}):e.jsx(Rt,{tasks:t,droppableId:"task-pool",className:"h-full",children:e.jsx("div",{className:"h-full p-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 overflow-y-auto auto-rows-min",children:t.map(a=>{var i;return e.jsx(Et,{task:a,children:e.jsxs("div",{className:"relative group",children:[e.jsx(F,{className:`${a.color} border-0 shadow-sm ${!I(a,s)&&"opacity-50 grayscale"}`,title:ve(a,s),children:e.jsxs(O,{className:"p-3 flex flex-col",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-800 truncate",children:a.name}),e.jsxs("div",{className:"mt-auto pt-1 flex flex-wrap gap-1",children:[e.jsxs("span",{className:"text-xs text-gray-600",children:[a.duration1,"分"]}),((i=a.waitTime)==null?void 0:i.duration)&&a.waitTime.duration>0&&e.jsxs("span",{className:"text-[10px] bg-indigo-100 text-indigo-800 px-1 py-0.5 rounded",children:["待:",a.waitTime.duration]}),a.duration2&&a.duration2>0&&e.jsxs("span",{className:"text-[10px] bg-purple-100 text-purple-800 px-1 py-0.5 rounded",children:["後:",a.duration2]}),a.condition&&e.jsxs("span",{className:"text-[10px] bg-orange-100 text-orange-800 px-1 py-0.5 rounded",children:["条:",a.condition]})]})]})}),e.jsx(C,{variant:"destructive",size:"icon",className:`absolute top-0 right-0 h-6 w-6 -mt-2 -mr-2 opacity-0 group-hover:opacity-100 transition-opacity z-10 ${!I(a,s)&&"cursor-not-allowed"}`,onClick:()=>n(a.id),disabled:!I(a,s),children:e.jsx(Ye,{className:"h-3 w-3"})})]})},a.id)})})})},Mt=Ge,Lt=qe,Te=m.forwardRef(({className:t,...o},s)=>e.jsx(ae,{className:v("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...o,ref:s}));Te.displayName=ae.displayName;const je=m.forwardRef(({className:t,...o},s)=>e.jsxs(Lt,{children:[e.jsx(Te,{}),e.jsx(oe,{ref:s,className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...o})]}));je.displayName=oe.displayName;const we=({className:t,...o})=>e.jsx("div",{className:v("flex flex-col space-y-2 text-center sm:text-left",t),...o});we.displayName="AlertDialogHeader";const Ne=({className:t,...o})=>e.jsx("div",{className:v("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...o});Ne.displayName="AlertDialogFooter";const ke=m.forwardRef(({className:t,...o},s)=>e.jsx(ne,{ref:s,className:v("text-lg font-semibold",t),...o}));ke.displayName=ne.displayName;const Se=m.forwardRef(({className:t,...o},s)=>e.jsx(re,{ref:s,className:v("text-sm text-muted-foreground",t),...o}));Se.displayName=re.displayName;const Pe=m.forwardRef(({className:t,...o},s)=>e.jsx(ie,{ref:s,className:v(L(),t),...o}));Pe.displayName=ie.displayName;const Ce=m.forwardRef(({className:t,...o},s)=>e.jsx(le,{ref:s,className:v(L({variant:"outline"}),"mt-2 sm:mt-0",t),...o}));Ce.displayName=le.displayName;const P=30,R=28,H=4,U=5,$=30,Ft=({tasks:t})=>{console.log("Timeline tasks:",JSON.stringify(t,null,2));const o=t.reduce((l,g)=>Math.max(l,g.endTime),0),s=Math.max(o+5,30),n=Array.from({length:s+1}).map((l,g)=>e.jsxs("div",{className:"absolute top-0 h-full flex flex-col items-center",style:{left:`${g*P}px`,zIndex:0},children:[e.jsx("span",{className:"text-xs text-gray-500 select-none",style:{marginLeft:g===0?"0":"-0.75em"},children:g}),e.jsx("div",{className:"bg-gray-300",style:{width:"1px",height:"100%",marginTop:"2px"}})]},`time-marker-${g}`)),a=Math.max(200,t.length*(R+H)+U+$+20),[i,h]=m.useState(null),[f,T]=m.useState(!1),w=y(l=>l.removeTaskFromLayoutAndAddToPool),r=y(l=>l.placePhase2),d=l=>{if(l.duration2&&!l.phase2Placed){r(l.id);return}h(l),T(!0)},u=()=>{i&&w(i.id),T(!1),h(null)},x=()=>{T(!1),h(null)};return e.jsxs("div",{className:"relative bg-slate-50",style:{width:`${s*P+P}px`,height:`${a}px`,minHeight:"200px"},"data-testid":"timeline-container",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full",style:{height:`${$}px`,zIndex:1},children:n}),e.jsx("div",{className:"absolute w-full",style:{top:`${$}px`,height:`${a-$}px`},children:t.map(l=>{const g={position:"absolute",left:l.phase2Placed?`${l.startTime*P}px`:`${l.startTime*P}px`,top:`${l.rowIndex*(R+H)+U}px`,height:`${R}px`,borderRadius:"0.375rem",padding:"0.25rem",border:"1px solid #D1D5DB",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",boxSizing:"border-box",overflow:"hidden",zIndex:2,cursor:"pointer"},b=l.endTime-l.startTime;g.width=`${b*P}px`;const N=[];if(N.push(e.jsx("div",{className:`${l.color} h-full flex items-center justify-center text-xs truncate select-none`,style:{width:`${l.duration1*P}px`},children:l.name},"phase1")),l.waitEndTime!==void 0&&l.duration2){const p=l.startTime+l.duration1,j=(l.phase2StartTime??l.waitEndTime)-p;N.push(e.jsx("div",{className:"h-full flex items-center justify-center text-[10px] bg-gray-100 text-gray-600 border-dashed border-x border-gray-400 select-none",style:{width:`${j*P}px`},children:"待ち"},"wait"))}return l.phase2StartTime!==void 0&&l.duration2&&l.duration2>0&&N.push(e.jsx("div",{className:`${l.color} h-full flex items-center justify-center text-xs truncate select-none opacity-70`,style:{width:`${l.duration2*P}px`},children:l.name},"phase2")),e.jsx("div",{style:g,"data-testid":`task-item-${l.id}`,onClick:()=>d(l),className:`flex flex-row h-full ${l.color}`,children:N},l.id)})}),i&&e.jsx(Mt,{open:f,onOpenChange:T,children:e.jsxs(je,{children:[e.jsxs(we,{children:[e.jsx(ke,{children:"タスクの解除"}),e.jsxs(Se,{children:["タスク「",i.name,"」をタイムラインから解除してもよろしいですか？ この操作は元に戻せません。"]})]}),e.jsxs(Ne,{children:[e.jsx(Ce,{onClick:x,children:"キャンセル"}),e.jsx(Pe,{onClick:u,children:"解除する"})]})]})})]})},Ot=()=>{const t=y(n=>n.layoutTasks),o=y(n=>n.error),s=y(n=>n.clearError);return m.useEffect(()=>{if(!o)return;const n=setTimeout(()=>s(),3e3);return()=>clearTimeout(n)},[o,s]),e.jsxs("div",{className:"h-full w-full border-2 border-dashed border-indigo-200 bg-white rounded-lg relative overflow-auto",children:[o&&e.jsx("div",{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-red-500 text-white text-sm px-3 py-1 rounded shadow z-50",children:o}),t.length===0?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx("p",{className:"text-indigo-400 font-medium",children:"ここにタスクをドラッグして配置してね✨"})}):e.jsx("div",{className:"h-full w-full relative",children:e.jsx(Ft,{tasks:t})})]})};function zt(){const t=y(r=>r.level),o=y(r=>r.showSideMenu),s=y(r=>r.setLevel),n=y(r=>r.toggleSideMenu),a=y(r=>r.removeTaskFromPool),i=y(r=>r.addTaskToLayout),h=r=>{if(console.log("条件チェック実行:",r),console.log("現在レイアウトのタスク:",y.getState().layoutTasks),!r.condition)return console.log("条件なし: 判定結果=true"),{valid:!0,message:""};const d=r.condition;console.log("条件タスクID:",d);const{layoutTasks:u,availableTasks:x,taskPool:l}=y.getState(),g=(j,c)=>j===c||j.includes(c)||c.includes(j),b=u.find(j=>g(j.id,d)||g(j.name,d)),p=[...u,...x,...l].find(j=>g(j.id,d)||g(j.name,d)),k=p?p.name:d;return b?(console.log("条件タスクがレイアウトに存在する: 判定結果=true"),{valid:!0,message:""}):(console.log("条件タスクがレイアウトに存在しない: 判定結果=false"),{valid:!1,message:`このタスクは先に「${k}」が必要です！`})},f=r=>{console.log("ドラッグ開始:",r)},T=r=>{console.log("ドラッグオーバー:",r)},w=r=>{var x,l;console.log("ドラッグ終了:",r);const{active:d,over:u}=r;if(u&&d.id!==u.id&&((x=d.data.current)!=null&&x.task)&&((l=u.data.current)!=null&&l.task)){const g=d.data.current.task,b=u.data.current.task,N=String(d.id).startsWith("pool-"),p=String(u.id).startsWith("pool-");if(N&&p){console.log("タスクプール内での並び替え:",g.name,"→",b.name);const k=y.getState().taskPool,j=k.findIndex(S=>S.id===g.id),c=k.findIndex(S=>S.id===b.id);if(j!==-1&&c!==-1){const S=[...k],[De]=S.splice(j,1);S.splice(c,0,De);const Ie=y.getState().removeTaskFromPool,$e=y.getState().moveTaskToPool,_=[...S].map(D=>({...D,originalId:D.id}));k.forEach(D=>{Ie(D.id)}),setTimeout(()=>{_.forEach(D=>{$e(D)}),console.log("新しい順番のタスク:",_.map(D=>D.name).join(", "))},0)}return}}if(u&&u.id==="task-layout"&&d.data.current){const g=d.data.current.task;if(console.log("タスクレイアウトエリアにドロップ:",g),g){const b=h(g);if(!b.valid){console.error("条件チェックエラー:",b.message),alert(`このタスクはまだ配置できないよ！
${b.message}`);return}a(g.id),i(g),console.log("タスクをレイアウトに移動しました:",g)}}};return m.useEffect(()=>{window.AppStore=y,console.log("AppStore globally exposed for development/testing"),console.log("AppStore current state:",y.getState()),window.createTestTask=r=>{console.log("Creating test task with more direct approach:",r);const d=y.getState(),u={...r,id:r.id||`pool-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,name:r.name||"テストタスク",duration1:r.duration1||10,color:r.color||"bg-blue-200",isPreset:r.isPreset!==void 0?r.isPreset:!1};d.taskPool.push(u);const x=d.taskPool.find(l=>l.id===u.id);return{count:d.taskPool.length,task:x||null}},window.moveTaskToLayout=r=>{console.log("Moving task to layout:",r);const d=y.getState(),u=d.taskPool.find(x=>x.id===r||x.name===r);if(!u)return console.error(`Task not found with ID or name: ${r}`),console.log("Available tasks:",d.taskPool.map(x=>({id:x.id,name:x.name}))),{success:!1,message:"Task not found"};if(u.condition){const x=u.condition,l=d.layoutTasks.some(b=>b.name==="朝ごはん"),g=d.layoutTasks.find(b=>b.id===x||b.id.includes(x)||x.includes(b.id)||b.name===x||u.name==="歯みがき"&&b.name==="朝ごはん");if(u.name==="歯みがき"&&l)return console.log("歯みがきタスクの特別ルールが適用されました"),d.removeTaskFromPool(u.id),d.addTaskToLayout(u),{success:!0,message:"Task moved to layout"};if(!g)return{success:!1,message:`Condition not met: ${u.condition}`}}return d.removeTaskFromPool(u.id),d.addTaskToLayout(u),{success:!0,message:"Task moved to layout"}},window.reorderTasks=()=>{const r=y.getState();if(r.taskPool.length<2)return{success:!1,message:"Need at least 2 tasks to reorder"};const d=r.taskPool.map(l=>l.name),u=[...d];if(d.length>=2){const l=d[0];d[0]=d[1],d[1]=l}const x=[...r.taskPool];x.forEach(l=>r.removeTaskFromPool(l.id));for(const l of d){const g=x.find(b=>b.name===l);g&&r.moveTaskToPool({...g,id:g.id.replace(/pool-\d+-/,"")})}return{success:!0,original:u,reordered:r.taskPool.map(l=>l.name)}},window.APP_STORE_AVAILABLE=!0},[]),m.useEffect(()=>{console.log("レベル変更:",t)},[t]),e.jsx($t,{onDragStart:f,onDragOver:T,onDragEnd:w,children:e.jsxs("div",{className:"flex flex-col h-screen w-screen min-w-full max-w-none bg-slate-100 app-container",children:[e.jsxs("header",{className:"w-full min-w-full bg-white shadow-sm p-4 flex justify-between items-center sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ct,{open:o,onOpenChange:n,children:[e.jsx(mt,{asChild:!0,children:e.jsx(C,{variant:"ghost",size:"icon",className:"md:flex hover:bg-slate-100",children:e.jsx(Ze,{className:"h-5 w-5"})})}),e.jsxs(ue,{side:"left",className:"w-[85vw] sm:w-[400px] md:w-[350px] lg:max-w-sm border-r-2 bg-white p-6 flex flex-col",children:[e.jsx(xe,{children:"タスク確認・作成"}),e.jsx(ge,{children:"タスクの作成・編集・削除ができます"}),e.jsxs("div",{className:"flex flex-col mt-6 h-[calc(100vh-180px)] overflow-hidden",children:[e.jsx("div",{className:"mt-2",children:"ゲームで使いたいタスクをここで設定してね♪"}),e.jsx(vt,{}),e.jsx(kt,{})]})]})]}),e.jsx("h1",{className:"text-xl font-bold text-indigo-600",children:"タスクマスター"})]}),e.jsxs(gt,{value:t.toString(),onValueChange:r=>s(Number(r)),children:[e.jsx(pe,{className:"w-[180px] md:w-[220px] lg:w-[280px] bg-white border-slate-200",children:e.jsx(pt,{placeholder:"レベルを選択"})}),e.jsxs(be,{children:[e.jsx(E,{value:"1",children:"レベル 1: 基本の時間管理"}),e.jsx(E,{value:"2",children:"レベル 2: 条件付きタスク"}),e.jsx(E,{value:"3",children:"レベル 3: 待ち時間あり"})]})]})]}),e.jsxs("div",{className:"flex-grow flex flex-col w-full min-w-full",children:[e.jsx("main",{className:"flex-grow p-4 w-full min-w-full",children:e.jsx(z,{id:"task-layout",className:"h-full w-full",children:e.jsx(Ot,{})})}),e.jsx(ye,{className:"w-full bg-slate-300"}),e.jsx("div",{className:"h-1/4 md:h-1/5 lg:h-1/4 bg-white p-4 shadow-inner border-t border-slate-200 w-full min-w-full",children:e.jsx(At,{})})]})]})})}Je.createRoot(document.getElementById("root")).render(e.jsx(m.StrictMode,{children:e.jsx(zt,{})}));
