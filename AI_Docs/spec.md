# 小学校3年生向けタスク管理ゲーム要件定義書

## 1. プロジェクト概要

### 1.1 目的

小学校3年生向けに、実生活でやらなければならないことをタスク化（項目化・時間見積もり）して、どういう順番でやると効率が良いかを考えるきっかけとなるゲームを開発する。

### 1.2 対象ユーザー

- 小学校3年生の児童
- 家庭でタブレット（主にiPad）を使用する子ども

### 1.3 使用環境

- メイン：iPad（標準サイズ）
- その他：他の環境でも動作することが望ましい
- ユーザー認証不要（1環境1ユーザー）
- 進捗保存機能あり

## 2. 画面構成

### 2.1 画面レイアウト

- **画面上部**：レベル設定（プルダウンメニュー）
- **画面左側**：タスク確認・作成画面（サイドメニュー）
- **画面中心**：タスクレイアウト（メイン）
- **画面下部**：タスクプール

### 2.2 レベル設定

- **レベル1**：所要時間だけのタスクを並べる
- **レベル2**：レベル1のタスクに加え、条件を含むタスクも並べる
- **レベル3**：レベル2のタスクに加え、待ち時間も含むタスクを並べる
- **レベル4**：レベル3のタスクに加え、依頼も含むタスク（全てのタスク）を並べる
- **レベル5**：レベル4のタスクを並べている途中で、割り込みタスクをランダムで加える

## 3. 機能詳細

### 3.1 タスク確認・作成画面

- ハンバーガーメニューでタスク確認・作成画面の表示・非表示を切り替え
- プリセットタスク例：「顔を洗う」(1分)、「朝ご飯」(15分)、「はみがき」(3分、朝ご飯のあと)、「朝勉強」(10分、歯磨きのあと)
- プリセットされた基本のタスクとカスタムタスクのタスク名一覧をリスト形式で表示
  - タスクは丸みを帯びた四角の中にタスク名が記載されたデザイン
  - 全てのタスクの四角は、ポップなユニバーサル色に自動設定
- レベル設定に合わせて、使用できないタスクはグレーアウト
  - 例：レベル1選択時、条件が入力されているタスクは使用不可
- カスタムタスク作成機能
  - 上部の[+]ボタンで作成メニューを表示
  - タスク名・所要時間・条件・待ち時間・依頼の5つの項目を入力（条件・待ち時間・依頼の入力は任意）
  - 待ち時間は数字を選択（単位は分）。横にある誤差ボタンを押すとxx分～xx分に設定可能
  - 待ち時間を設定すると[所要時間2]入力項目が出現（待ち時間終了からタスク完了までの時間を設定）
    - そのとき[所要時間]は[所要時間1]という表示に変わる（タスク開始から待ち時間開始までの時間）
  - 条件はタスク名をプルダウンメニューで選択し、どのタスクの後にしか実施できないという条件を付ける
  - 入力後、左下の[登録]ボタンを押すとリストに追加
  - 右下の削除ボタンを押すと削除
- タスクの編集・削除
  - タスクをクリックすると編集画面表示
- タスクの並び替え
  - ドラッグアンドドロップで順番を入れ替え可能
- 各タスク左の[+]ボタンでタスクプールに追加
  - タスク確認・作成画面にはそのタスクが残るため、同じタスクを複数追加可能

### 3.2 タスクプール

- タスク確認・作成画面から追加されたタスクを格子状に規則正しくレイアウト
  - ドラッグしやすいよう、適切な空間を空けて配置
- タスクプール内でドラッグすることで順番の入れ替えが可能
- 各タスクの右にある削除ボタンでプールからタスク削除可能
- 各タスクはタスク確認・作成画面と同じ四角いデザインで表現
  - 横幅は時間に関係なく一律。8文字程度が表示されるサイズ
- タスクをクリックするとタスクの全情報がポップアップ
  - ポップアップした情報は[閉じる]ボタンまたは余白/別タスクをクリックして閉じる
  - 数値をクリックすると編集可能
  - 設定されていない項目（条件など）は空白で表示され、それについても編集で追加可能
  - 編集した数値はタスク確認・作成画面とは独立して変化する（エイリアスでは無くコピー）
- タスクレイアウト画面にドラッグするとタスクが移動（タスクプールからは消える）
- [ランダム]ボタン（タスクプールの右下）
  - タスク確認・作成画面からランダムでタスクをピックアップ
  - タスクの数もランダム

### 3.3 タスクレイアウト

- タイムドメインのチャートにシングルスレッドでタスクを配置
  - 左が開始位置、右に向かって時間が進む
  - 1分ごとに線で区切られ、上部に経過時間を表示
  - 画面右端まで行ったら横にスクロール可能
    - タッチパネルであれば、タスクの四角がない領域を横にスワイプすることでスクロール可能
  - ガントチャートのように上から順に1行ずつタスクが下に接続
  - 時間軸をピンチすると横方向に拡大縮小可能
    - 四角にタスク名が収まりきらなかった場合、省略された[...]表示が拡大により全て表示される
- タスクはタスクプールからドラッグアンドドロップで配置
  - 最初に配置されたタスクは自動的に開始位置（左上）に配置
  - 次にドロップされたタスクはその後ろに自動的に結合
  - 条件に一致しないタスクはタスクプールに戻される
  - 結合時には派手な結合エフェクトが表示（GSAPを使用した複雑なアニメーション）
  - 結合されたタスクをタップすると[解除]メニューが出現
    - 解除されたタスクの後ろに結合していたタスクも解除され、タスクプールに戻る
- レベル5の割り込みは、ランダムにタスク確認・作成画面のタスクが1つ追加され、強制的に結合される
  - 例えばタスクプールのタスクが10個あれば、何個目に配置したときに強制的に追加されるかがランダムで決まる
  - つまり10個配置が終わるまでの間に必ず1回強制追加される
  - 解除するとタスクプールに戻る
- 配置されたタスクのデザイン
  - タスク確認・作成画面の四角と同じデザインで四角の中にタスク名があり、その横に時間等の要素が記載される
  - 設定されていない要素は表示されない
  - この画面ではタスクの数値等は修正できない（必要ならタスクプールに戻してから修正する）
  - 四角の横幅はタイムドメインのチャートの時間と一致（タスクプールの横幅とは異なる）
- 待ち時間と依頼のあるタスクの表示
  - [所要時間1]の時間が経過したら次のタスク（下に接続）へ移行可能
  - タスク名の四角の後ろに待ち時間中の領域が薄い色で表示される
  - 待ち時間に幅がある場合、その幅の部分は輪郭が点線になる
  - 待ち時間終了後、その後ろに[所要時間2]の時間分タスクが表示されるが、開始時間は後ろに自由に移動させることが出来る
    - 例えば待ち時間中に長いタスクを行い、そのタスクが終了してから続きを開始することが出来る
    - [所要時間2]の部分をドラッグすると、最も後ろのタスクの終了部と結合され結合エフェクトが出る

## 4. アクセシビリティ

- コントラスト比：テキストと背景色が適切なコントラスト比を持つよう設計
- タッチエリア：ボタンやオブジェクトのタッチ領域を拡大し、誤操作を防止

## 5. 技術スタック

### 5.1 推奨技術スタック

- **ビルドツール**: Vite (React TypeScript+SWC)
- **UI・スタイリング**: React + Tailwind CSS + shadcn/ui（高品質なカスタマイズ可能なUIコンポーネントライブラリ）
- **状態管理**: Zustand（軽量な状態管理ライブラリ）
- **ドラッグ・アンド・ドロップ**:
  - dnd-kit: 高機能なドラッグ、ドロップ操作全般（タスク配置、並び替え、条件チェックなど）
- **アニメーション**:
  - Framer Motion: 基本的なトランジション効果・メニュー操作など
  - GSAP: 複雑なアニメーション（タスク結合エフェクト、時間軸ピンチ操作）
- **ストレージ**: localStorage（進捗保存用）
- **ホスティング**: GitHub Pages
- **ソース管理**: GitHub
- **コード品質管理**: ESLintとPrettier
- **テスト**: Playwright

### 5.2 アニメーションライブラリの使い分け

- **Framer Motion**:

  - タスクのドラッグ＆ドロップ
  - タスクの移動アニメーション
  - 基本的なトランジション効果
  - React要素との統合が容易な部分

- **GSAP**:
  - タスクの結合エフェクト（派手なエフェクト）
  - 時間軸のピンチ操作による拡大縮小
  - 複雑なタイムラインアニメーション
  - パフォーマンスが重要な複雑なアニメーション

## 6. 保存機能

- ローカルストレージを使用してユーザーの進捗を保存
- 保存内容：
  - 現在のレベル
  - 作成したカスタムタスク
  - タスクプールの状態
  - タスクレイアウトの状態
- 自動保存：
  - タスクの追加・削除時
  - タスクの配置変更時
  - レベル変更時

## 7. 操作性

- タッチ操作とマウス操作の両立
  - タッチ操作：ドラッグ、タップ、ピンチ操作に対応
  - マウス操作：クリック、ドラッグ&ドロップに対応
- 誤操作防止：
  - 重要な操作（タスク削除など）は確認ダイアログを表示
  - タッチ領域を十分に確保

## 8. エラーハンドリングとフィードバック

- 条件不一致時のフィードバック：
  - 条件に一致しないタスクをドロップした場合、視覚的フィードバックを表示
  - タスクが自動的にタスクプールに戻る際のアニメーション
- 操作ガイド：
  - 初回利用時にチュートリアルを表示
  - ヘルプボタンからいつでも操作方法を確認可能
