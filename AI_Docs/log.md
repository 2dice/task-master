# 作業ログ (log.md)

## Step 1: 開発環境構築とGitHub Pages設定 (2025-04-22)

### うまくいった手法（手順）

1. **段階的な環境構築アプローチ**

   - 基本環境（Vite+React+TypeScript）→UI（Tailwind+shadcn/ui）→機能（dnd-kit等）→品質管理（ESLint+Prettier+Playwright）の順で導入
   - 各ステップで動作確認を行い、問題があればすぐに対処

2. **複合ビルドプロセスの設定**

   - vite.config.tsでdocsディレクトリへのビルド出力設定
   - package.jsonでGitHub Pages用のURLパス設定
   - コードチェック（lint+format）をビルド前に自動実行する設定

3. **テスト駆動開発の導入**
   - 基本UIに対するPlaywrightテストの作成
   - 自動化テストによる品質保証の基盤確立

### 汎用的なナレッジ（タスク進め方や問題解決手法など）

1. **モジュール間の依存関係理解の重要性**

   - shadcn/uiはTailwind CSSに依存するため、導入順序は重要
   - tsconfig.jsonのパス設定はエイリアスインポート（@/〜）に必須

2. **設定ファイルの段階的検証**

   - Vite, TypeScript, ESLint等の設定ファイルは変更後に即テスト実行
   - 小さな変更を積み重ねる方が効率的で問題発見も容易

3. **TODOリストによる進捗管理**
   - 大きなタスクを小さなステップに分解して管理
   - 完了したタスクをマークすることでモチベーション維持と進捗可視化

### 具体的なナレッジ（ツールの使い方やハマりやすいポイント）

1. **shadcn/uiの導入手順**

   - npx shadcn@latest initではなく、古いshadcn-uiコマンドは非推奨
   - コンポーネントは個別にnpx shadcn@latest add [コンポーネント名]でインストール
   - React 19との互換性のために--forceオプションが必要な場合あり

2. **import alias設定のポイント**

   - tsconfig.jsonだけでなくvite.config.tsにも同じパス設定が必要
   - `@/*`→`./src/*`の設定は両方のファイルで一致させる

3. **Playwrightテストの注意点**
   - サンプルテスト(example.spec.ts)は外部サイトにアクセスするため削除または修正が必要
   - 開発サーバー起動中にテスト実行する場合は別ターミナルが必要
   - 一部ブラウザ依存ライブラリがなくても基本テストは実行可能

## Step 2: 基本レイアウト構築（2025-04-30）

### うまくいった手法（手順）

1. **4分割レイアウトの段階的実装**

   - 最初にシンプルなTailwindフレックスレイアウトで基本構造を作成
   - 次にshadcn/uiコンポーネントを順次統合（Sheet, Select, Separator等）
   - 最後にレスポンシブ対応とiPad横向き最適化を追加

2. **UIコンポーネントの効果的な組み合わせ**

   - シートコンポーネントをサイドメニューに活用し、モバイル表示時の切り替えを実現
   - セレクトコンポーネントでレベル選択UIをシンプルに実装
   - lucide-reactのアイコンでUIの視認性向上

3. **Playwrightテストの段階的構築**
   - 最初は基本的なUI要素の存在確認テストから開始
   - 次に動的な要素（ドロップダウン等）の機能テストを追加
   - 最終的に全ブラウザ互換性を確保するためのセレクタ最適化

### 汎用的なナレッジ（タスク進め方や問題解決手法など）

1. **UIテストのロバスト性確保手法**

   - 複数のセレクタを用意し、最初に見つかったものを使用する戦略
   - テキスト内容と要素の役割（role）の両方を確認
   - 複数のブラウザエンジンで検証して互換性を確保

2. **DOM構造変化の検証アプローチ**

   - 動的UIの変化は要素数の増減で確実に検出
   - data-state属性などのDOM属性変化も重要な検証ポイント
   - 画面サイズ変更時のレイアウト変化も適切にテスト

3. **デバッグ出力を活用したテスト改善**
   - コンソールログでDOMの構造や属性を詳細に出力
   - 将来の拡張に備えてDOM階層とデータ属性を文書化
   - スクリーンショットを取得して状態を視覚的に記録

### 具体的なナレッジ（ツールの使い方やハマりやすいポイント）

1. **shadcn/ui (Radix UI) コンポーネントのテスト**

   - Radix UIはポータル（data-radix-popper-content-wrapper）を使用するため通常のDOM階層では捕捉できない
   - ドロップダウンなどは `role="listbox"`, `role="option"` 属性で確実に特定可能
   - `data-state="open"` 属性は要素の状態変化を検知するのに最適

2. **Playwrightでのブラウザ互換性対応**

   - WebKit (Safari) テストは追加のシステムライブラリが必要（libgstcodecparsers等）
   - クリック後のstate変化を待つには `page.waitForTimeout(500)` が効果的
   - テスト分割（Chromium+Firefox用と全ブラウザ用）でCI/CD効率化

3. **レスポンシブUIのテスト技法**
   - 複数のビューポートサイズ（375, 768, 1024）でのテストが必須
   - 共通の視覚要素と位置だけでなく、表示/非表示の切り替わりもテスト
   - iPad横向き（1024x768）は特に重要なターゲットサイズ

## Step 3: タスク状態管理（2025-05-01）

### うまくいった手法（手順）

1. **段階的なデータモデル設計とStore実装**

   - まず必要な型定義（Task、LayoutTask、AppState）をシンプルに作成
   - Zustandストアの基本構造と初期状態を実装
   - アクション（タスク追加/更新/削除など）を段階的に追加

2. **プリセットタスクとストア機能の統合**

   - プリセットタスクをストア内に定義して初期データとして活用
   - レベルやメニュー表示状態などのアプリ全体の状態も一元管理
   - UIとのスムーズな連携のためのセレクタ関数も実装

3. **テスト駆動による状態管理の検証**
   - PlaywrightでUIと状態変化の両方を検証するテスト設計
   - ブラウザ側からZustandストアの状態を取得する機能実装
   - 状態変化を検証するアサーションの追加

4. **テストの統合と最適化**
   - app.spec.tsとstore.spec.tsの機能を一つのファイルに統合
   - 共通のユーティリティ関数（getZustandState）の抽出と再利用
   - 状態変化（showSideMenu, level）を明示的にテスト
   - 不要な冗長コード（スクリーンショット撮影など）の削除
   - テスト実行時間の短縮（20秒程度でフルテスト完了）

### 汎用的なナレッジ（タスク進め方や問題解決手法など）

1. **型定義先行アプローチの有効性**

   - インターフェースを先に定義することで実装の方向性が明確化
   - TypeScriptの型推論を最大限活用するための構造設計
   - 共通型を使った一貫性のあるデータ構造の維持

2. **状態管理の単一責任原則適用**

   - 状態更新ロジックをストア内に閉じ込めてUIから分離
   - 必要最小限のステート公開によるカプセル化
   - 一貫した命名規則による可読性と保守性の向上

3. **ブラウザ-テスト連携のベストプラクティス**

   - グローバル空間を活用した状態共有でテストの柔軟性向上
   - ステートの露出は最小限にしながらテスト可能性を確保
   - 実行環境に依存しない堅牢なテスト設計

4. **テスト統合による管理効率化**
   - 重複するテストを一箇所にまとめることで保守性向上
   - 共通処理の抽出によるDRY原則の徹底
   - テストファイル数削減による実行時間とコンテキスト切替コスト低減

5. **状態変化テストの設計パターン**
   - 操作前→操作→操作後の3段階で状態を確認
   - UIの変化と内部状態の変化を両方検証
   - 複数の状態変化（複数回の操作）も連続的に検証

### 具体的なナレッジ（ツールの使い方やハマりやすいポイント）

1. **Zustandの効果的な活用法**

   - `create<State>()`による型安全な状態管理の実現
   - set/getを使った副作用の少ない状態更新パターン
   - `useAppStore(s => s.xxx)`セレクタによる効率的な参照

2. **ESLint警告への対応テクニック**

   - 特定ディレクトリ（型定義など）向けの警告抑制ルール設定
   - 未使用パラメータに対するプレフィックス（_）命名規則の導入
   - 適切な規則セットによる生産性と品質のバランス確保

3. **Playwrightでのアプリ状態テスト手法**

   - `page.evaluate()`を使ったブラウザ内JavaScript実行
   - グローバルオブジェクト経由の状態アクセスパターン
   - TypeScriptのエラー抑制アノテーション（@ts-expect-error）の適切な使用

4. **テストコードのリファクタリング手順**

   - まず重複部分を特定して統合
   - 次に共通関数を抽出して再利用性向上
   - 最後に細部の最適化（ログ削減、アサーション改善）

5. **テスト実行速度の最適化テクニック**
   - 不要なスクリーンショット撮影の削除
   - 必要最小限のwaitForTimeoutの使用
   - 複数ブラウザでの検証を開発時はChromium+WebKitに限定
